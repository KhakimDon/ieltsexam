<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IELTS Full Reading Practice</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, sans-serif;
            background-color: #ffffff;
            line-height: 1.4;
            font-size: 16px;
        }

        /* Login Screen Styles */
        .login-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10000;
        }

        .login-content {
            background: white;
            padding: 40px;
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            max-width: 400px;
            width: 90%;
            text-align: center;
        }

        .login-logo {
            margin-bottom: 30px;
        }

        .login-logo svg {
            width: 60px;
            height: 60px;
            color: #667eea;
        }

        .login-content h1 {
            color: #333;
            font-size: 24px;
            margin-bottom: 10px;
            font-weight: 600;
        }

        .login-content p {
            color: #666;
            font-size: 16px;
            margin-bottom: 30px;
        }

        .form-group {
            margin-bottom: 20px;
            text-align: left;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 500;
            font-size: 14px;
        }

        .form-group input {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s ease;
            box-sizing: border-box;
        }

        .form-group input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .login-button {
            width: 100%;
            background: #667eea;
            color: white;
            border: none;
            padding: 14px 20px;
            font-size: 16px;
            font-weight: 600;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 10px;
        }

        .login-button:hover {
            background: #5a6fd8;
            transform: translateY(-1px);
        }

        .login-button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .loading {
            opacity: 0.7;
            pointer-events: none;
        }

        .shake {
            animation: shake 0.5s ease-in-out;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        .error-message {
            color: #e74c3c;
            font-size: 14px;
            margin-top: 10px;
            display: none;
        }

        .success-message {
            color: #27ae60;
            font-size: 14px;
            margin-top: 10px;
            display: none;
        }

        /* Candidate ID Screen Styles */
        .candidate-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }

        .candidate-content {
            background: white;
            padding: 40px;
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            max-width: 450px;
            width: 90%;
            text-align: center;
        }

        .candidate-logo {
            margin-bottom: 30px;
        }

        .candidate-logo svg {
            width: 60px;
            height: 60px;
            color: #667eea;
        }

        .candidate-content h1 {
            color: #333;
            font-size: 24px;
            margin-bottom: 10px;
            font-weight: 600;
        }

        .candidate-content p {
            color: #666;
            font-size: 16px;
            margin-bottom: 30px;
        }

        .candidate-id-input {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 18px;
            text-align: center;
            letter-spacing: 2px;
            font-weight: 600;
            transition: border-color 0.3s ease;
            box-sizing: border-box;
        }

        .candidate-id-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .candidate-button {
            width: 100%;
            background: #667eea;
            color: white;
            border: none;
            padding: 14px 20px;
            font-size: 16px;
            font-weight: 600;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 20px;
        }

        .candidate-button:hover {
            background: #5a6fd8;
            transform: translateY(-1px);
        }

        .candidate-button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .back-button {
            background: #95a5a6;
            color: white;
            border: none;
            padding: 10px 20px;
            font-size: 14px;
            border-radius: 6px;
            cursor: pointer;
            transition: background 0.3s ease;
            margin-top: 15px;
        }

        .back-button:hover {
            background: #7f8c8d;
        }

        /* Hide other screens initially */
        .start-screen {
            display: none;
        }

        .header {
            display: none;
        }

        .main-container {
            display: none;
        }

        .nav-arrows {
            display: none;
        }

        .nav-row {
            display: none;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, sans-serif;
            background-color: #ffffff;
            line-height: 1.4;
            font-size: 16px;
        }



        .header {
            background-color: #ffffff;
            padding: 12px 20px;
            border-bottom: 1px solid #e0e0e0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 100;
            height: 60px;
        }

        .ielts-logo {
            display: none;
        }

        .test-info {
            display: flex;
            align-items: center;
            gap: 30px;
            font-size: 14px;
            color: #333;
        }

        .audio-indicator {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 16px;
        }

        .audio-icon {
            width: 16px;
            height: 16px;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon></svg>') no-repeat center;
        }

        .header-icons {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .telegram-link {
            color: #0088cc;
            text-decoration: none;
            font-weight: 600;
            font-size: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .telegram-link:hover {
            text-decoration: underline;
        }

        .telegram-link::before {
            content: '';
            display: inline-block;
            width: 20px;
            height: 20px;
            background-color: currentColor;
            -webkit-mask-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.78 18.65l.28-4.23l7.68-6.92c.34-.31-.07-.46-.52-.19L7.74 13.3L3.64 12c-.88-.25-.89-1.37.2-1.64l16.56-6.4c.75-.29 1.4.22 1.2.94l-2.67 12.61c-.22.95-1.13 1.18-1.78.73l-4.5-3.32l-2.23 2.15c-.47.44-1.29.21-1.48-.37z"/></svg>');
            mask-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.78 18.65l.28-4.23l7.68-6.92c.34-.31-.07-.46-.52-.19L7.74 13.3L3.64 12c-.88-.25-.89-1.37.2-1.64l16.56-6.4c.75-.29 1.4.22 1.2.94l-2.67 12.61c-.22.95-1.13 1.18-1.78.73l-4.5-3.32l-2.23 2.15c-.47.44-1.29.21-1.48-.37z"/></svg>');
            background-size: contain;
            background-repeat: no-repeat;
        }

        #volume-slider {
            -webkit-appearance: none;
            appearance: none;
            width: 80px;
            height: 4px;
            background: #ddd;
            outline: none;
            border-radius: 2px;
            cursor: pointer;
        }

        #volume-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 14px;
            height: 14px;
            border-radius: 50%;
            background: #333;
            cursor: pointer;
        }

        #volume-slider::-moz-range-thumb {
            width: 14px;
            height: 14px;
            border-radius: 50%;
            background: #333;
            cursor: pointer;
            border: none;
        }

        .icon {
            width: 20px;
            height: 20px;
            cursor: pointer;
            opacity: 0.7;
            color: #333;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .icon:hover {
            opacity: 1;
        }
        
        #play-pause-btn {
            background: none;
            border: none;
            padding: 0;
        }

        .main-container {
            margin-top: 60px;
            display: flex;
            flex-direction: column;
            background: #ffffff;
            height: calc(100vh - 60px); /* Full height minus header */
        }

        .panels-container {
            display: flex;
            flex: 1;
            overflow: hidden;
        }

        .passage-panel {
            flex: 1;
            padding: 20px 20px 100px;
            overflow-y: auto;
            min-width: 200px; /* Minimum width */
        }

        /* Passage Content */
        .text-center {
            text-align: center;
        }
        .reading-passage h4 {
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 15px;
            text-align: center;
        }
       
        .reading-passage p {
            margin-bottom: 1.2em;
        }

        .question ul li label {
            display: block;
            margin-top: 8px;
            cursor: pointer;
        }

        .questions-panel {
            flex: 1;
            padding: 20px 20px 100px;
            overflow-y: auto;
            min-width: 200px; /* Minimum width */
            border-left: 1px solid #e0e0e0;
        }

        .resizer {
            width: 10px;
            cursor: col-resize;
            background-color: #f0f0f0;
            background-image: url('data:image/svg+xml;charset=UTF-8,<svg xmlns="http://www.w3.org/2000/svg" width="10" height="30" viewBox="0 0 10 30"><path d="M4 11h2v2H4zM4 15h2v2H4zM4 19h2v2H4z" fill="%23888"/></svg>');
            background-repeat: no-repeat;
            background-position: center;
            flex-shrink: 0;
            flex-grow: 0;
        }

        /* Left Panel */
        .left-panel {
            width: 100%;
            padding: 20px;
        }

        /* Right Panel */
        .right-panel {
            display: none;
            width: 50%;
            padding: 20px;
            position: relative;
        }

        .help-button {
            background: #4a90e2;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 4px;
            font-size: 14px;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 5px;
            margin-bottom: 20px;
        }

        .help-button:hover {
            background: #357abd;
        }

        .section-title {
            font-weight: bold;
            margin-bottom: 15px;
            font-size: 18px;
        }

        .people-section {
            margin-bottom: 30px;
        }

        .people-table {
            width: 100%;
            border-collapse: collapse;
            border: 1px solid #ccc;
        }

        .people-table th {
            text-align: left;
            padding: 10px;
            font-weight: bold;
            border: 1px solid #ddd;
        }

        .people-table td {
            padding: 8px 10px;
            border: 1px solid #ddd;
        }

        /* Matrix matching table for Q33-38 */
        .matrix-table {
            width: 100%;
            border-collapse: collapse;
            border: 1px solid #ddd;
        }
        .matrix-table th,
        .matrix-table td {
            border: 1px solid #ddd;
            padding: 10px;
        }
        .matrix-table thead th {
            background: #0d6efd;
            color: #fff;
            text-align: center;
        }
        .matrix-table td.selectable {
            text-align: center;
            width: 60px;
            cursor: pointer;
            user-select: none;
        }
        .matrix-table td.selectable:hover {
            background: #f0f8ff;
        }
        .matrix-table td.matrix-selected {
            background: #dbeafe;
            border-color: #93c5fd;
            font-weight: 600;
        }

        .person-name {
            font-size: 16px;
        }

        .question-number {
            background: white;
            border: 1px solid #4a90e2;
            padding: 4px 8px;
            border-radius: 3px;
            font-weight: bold;
            font-size: 14px;
            color: #4a90e2;
            min-width: 30px;
            text-align: center;
        }

        .assigned-responsibility {
            background: #f0f0f0;
            padding: 4px 8px;
            border-radius: 3px;
            font-size: 14px;
            border: 1px solid #ddd;
        }

        .responsibilities-section {
            margin-bottom: 30px;
        }

        .responsibility-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            margin-bottom: 20px;
        }

        .responsibility-item {
            background: #f8f9fa;
            border: 1px solid #ddd;
            padding: 8px 12px;
            border-radius: 4px;
            cursor: move;
            font-size: 16px;
            text-align: center;
            transition: all 0.2s;
        }

        .responsibility-item:hover {
            background: #e9ecef;
            transform: translateY(-1px);
        }

        .responsibility-item.dragging {
            opacity: 0.5;
        }

        .questions-section {
            margin-bottom: 20px;
        }

        .question-title {
            font-weight: bold;
            margin-bottom: 10px;
            font-size: 16px;
        }

        .instruction {
            margin-bottom: 20px;
            font-size: 16px;
            color: #666;
        }

        /* Map Styles */
        .map-container {
            position: relative;
            margin: 20px 0;
            display: flex;
            justify-content: center;
        }

        .map-svg {
            border: 2px solid #333;
            background: white;
        }

        .map-room {
            fill: #f9f9f9;
            stroke: #333;
            stroke-width: 1;
        }

        .map-text {
            font-family: Arial, sans-serif;
            font-size: 13px;
            text-anchor: middle;
            fill: #333;
        }

        .map-number {
            font-family: Arial, sans-serif;
            font-size: 16px;
            font-weight: bold;
            text-anchor: middle;
            fill: #333;
        }

        .room-labels {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin: 20px 0;
        }

        .room-label {
            background: #f8f9fa;
            border: 1px solid #ddd;
            padding: 8px 12px;
            border-radius: 4px;
            cursor: move;
            font-size: 16px;
            text-align: center;
            transition: all 0.2s;
        }

        .room-label:hover {
            background: #e9ecef;
            transform: translateY(-1px);
        }

        .room-label.dragging {
            opacity: 0.5;
        }

        /* Navigation Arrows */
        .nav-arrows {
            position: fixed;
            bottom: 100px;
            right: 20px;
            display: flex;
            gap: 5px;
            z-index: 101;
        }

        .nav-arrow {
            width: 50px;
            height: 50px;
            background: #333;
            color: white;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 22px;
            font-weight: bold;
        }

        .nav-arrow:hover {
            background: #555;
        }

        .nav-arrow:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        /* Submit Answers Button */
        .submit-answers-button {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #dc3545;
            color: white;
            border: none;
            padding: 15px 25px;
            font-size: 16px;
            font-weight: 600;
            border-radius: 8px;
            cursor: pointer;
            z-index: 102;
            box-shadow: 0 4px 12px rgba(220, 53, 69, 0.3);
            transition: all 0.3s ease;
        }

        .submit-answers-button:hover {
            background: #c82333;
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(220, 53, 69, 0.4);
        }

        .submit-answers-button:active {
            transform: translateY(0);
        }

        /* Bottom Navigation - Exact Match */
        .nav-row {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: #ffffff;
        
            padding: 0;
            display: flex;
            align-items: center;
            height: 80px;
            z-index: 100;
        }

        .footer__questionWrapper___1tZ46 {
            display: flex;
            align-items: center;
            margin-right: 20px;
        }


        .footer__questionNo___3WNct {
            background: none;
            border: none;
            padding: 10px 15px;
            font-size: 16px;
            font-weight: 600;
            color: #333;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
            transition: background-color 0.2s;
        }

        .footer__questionNo___3WNct:hover {
            background-color: #f8f9fa;
        }

        .section-prefix {
            font-size: 16px;
        }

        .sectionNr {
            font-size: 16px;
            font-weight: bold;
        }

        .attemptedCount {
            font-size: 14px;
            color: #666;
            margin-left: 5px;
            font-weight: 400; /* Normal weight */
        }

        @media (max-width: 768px) {
            .attemptedCount {
                display: none;
            }
        }

        .footer__questionWrapper___1tZ46.selected .attemptedCount {
            display: none;
        }

        .footer__subquestionWrapper___9GgoP {
            display: none;
            gap: 2px;
            margin-left: 10px;
        }

        .footer__questionWrapper___1tZ46.selected .footer__subquestionWrapper___9GgoP {
            display: flex;
        }

        .subQuestion {
            width: 32px;
            height: 32px;
            border: 1px solid #ccc;
            background: white;
            color: #333;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            border-radius: 2px;
        }

        .subQuestion.answered {
            background-color: #e9ecef;
            border-color: #ddd;
        }
        .subQuestion.correct {
            background-color: #28a745;
            color: white;
            border-color: #28a745;
        }
        .subQuestion.incorrect {
            background-color: #dc3545;
            color: white;
            border-color: #dc3545;
        }

        .subQuestion:hover {
            background-color: #f0f0f0;
            border-color: #999;
        }

        .subQuestion.active {
            background-color: #4a90e2;
            color: white;
            border-color: #4a90e2;
        }

        .subQuestion.completed {
            background-color: #28a745;
            color: white;
            border-color: #28a745;
        }

        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }

        .footer__deliverButton___3FM07 {
            margin-left: auto;
            margin-right: 20px;
            background-color: #f0f0f0;
            color: #333;
            border: 1px solid #ccc;
            padding: 12px 20px;
            border-radius: 4px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: background-color 0.2s, border-color 0.2s;
            min-width: 170px;
            justify-content: center;
        }

        .footer__deliverButton___3FM07:hover {
            background-color: #e0e0e0;
            border-color: #bbb;
        }

        .footer__deliverButton___3FM07:disabled {
            background: #e9ecef;
            color: #6c757d;
            cursor: not-allowed;
            border-color: #ddd;
        }

        /* Time expiration overlay styles */
        .time-expiration-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 10000;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            font-family: Arial, sans-serif;
        }

        .completion-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 10000;
            display: flex;
            justify-content: center;
            align-items: center;
            font-family: Arial, sans-serif;
        }

        .fa-check::before {
            content: "✓";
        }

        .hidden {
            display: none !important;
        }

        /* Context Menu */
        .context-menu {
            position: absolute;
            background: white;
            border: 1px solid #ccc;
            border-radius: 6px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            z-index: 1000;
            display: none;
            min-width: 140px;
        }

        .context-menu-item {
            padding: 12px 16px;
            cursor: pointer;
            font-size: 16px;
            border-bottom: 1px solid #f0f0f0;
            transition: background-color 0.2s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .context-menu-item:hover {
            background-color: #f8f9fa;
        }

        .context-menu-item:last-child {
            border-bottom: none;
        }

        .highlight {
            background-color: #ffff00;
        }

        .comment-highlight {
            background-color: #90EE90;
            position: relative;
            cursor: help;
        }

        .comment-tooltip {
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: #333;
            color: white;
            padding: 8px 12px;
            border-radius: 4px;
            font-size: 14px;
            white-space: nowrap;
            z-index: 1000;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
        }

        .comment-highlight:hover .comment-tooltip {
            opacity: 1;
        }

        .question {
            margin-bottom: 40px;
        }
        .question p {
            margin-bottom: 10px;
        }
        .question ul, .question .people-table {
            margin-top: 0;
        }
        .question-prompt {
            margin-bottom: 20px;
        }
        .question ul {
            list-style: none;
            padding-left: 0;
        }
        .question ul li {
            margin-bottom: 5px;
        }
        .answer-input {
            border: 1px solid #888;
            border-radius: 4px;
            background-color: #fff;
            padding: 2px 5px;
            font-size: 16px;
            text-align: left;
            margin-right: 4px;
            margin-left: 4px;
            transition: border-color 0.3s, box-shadow 0.3s;
            height: 28px; /* Standard height */
            width: 150px; /* Standard width */
        }
        .answer-input.active-input {
            border-color: #4a90e2;
            box-shadow: 0 0 3px 1px rgba(74, 144, 226, 0.5);
        }
        .answer-input::placeholder {
            color: #999;
            font-weight: bold;
            text-align: center;
        }
        /* Keep placeholder centered visually even when input text is left-aligned */
        .answer-input::placeholder { text-align: center; }
        .answer-input.correct {
            border-color: #28a745;
            background-color: #e9f7ef;
        }
        .answer-input.incorrect {
            border-color: #dc3545;
            background-color: #f8d7da;
            color: #721c24;
        }
        .answer-input {
    z-index: 10;
    position: relative;
    pointer-events: auto;
}
.drag-drop-container {
            display: flex;
            gap: 30px;
            margin-top: 20px;
            align-items: flex-start;
            flex-direction: column;
        }
        .recommendations-box {
    display: flex
;
    flex-direction: column;
    gap: 8px;
    min-height: 200px;
}
        .recommendations-box .drag-item {
    border: 1px solid #3d3d3d;
    border-radius: 4px;
    cursor: move;
    font-size: 16px;
    font-weight: 600;
    text-align: left;
    transition: all 0.2s;
    user-select: none;
    color: #000000;
    padding: 0px 5px;
}
       
        .drag-item:hover {
            background: #e9ecef;
        }
        .drag-item.dragging {
            opacity: 0.5;
        }
        .drag-item.selected {
            border-color: #4a90e2;
            box-shadow: 0 0 0 2px rgba(74, 144, 226, 0.5);
        }
        .drop-zone {
            border: 2px dashed #aaa;
            border-radius: 4px;
            width: 50%;
            margin-top: 19px;
            margin-bottom: 5px;
            transition: background-color 0.2s, border-color 0.2s;
            padding: 0.5px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }
        .drop-zone.drag-over {
            background-color: #e6f4ff;
            border-color: #4a90e2;
        }
        .drop-zone.correct {
            background-color: #e9f7ef;
            border-color: #28a745;
            border-style: solid;
        }
        .drop-zone.incorrect {
            background-color: #f8d7da;
            border-color: #dc3545;
            border-style: solid;
        }
        .drop-zone.disabled {
            pointer-events: none;
        }
        .drop-zone .drag-item {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 15px;
            padding: 2px;
        }
        .drag-options-container {
            margin-top: 10px;
        }
        .drag-options-container .drag-item {
            display: block;
            width: fit-content;
            font-size: 15px;
            padding: 0.5px 10px;
            margin-bottom: 5px;
        }
        .drag-options-container .drag-item:last-child {
            margin-bottom: 0;
        }
        .q-number {
            color: #888;
            font-size: 14px;
            font-weight: bold;
        }
        .questions-container {
            width: 100%;
        }
        audio {
            width: 100%;
            margin-bottom: 20px;
        }
        .part-header {
            background-color: #f1f2ec;
            padding: 15px 20px;
            border: 1px solid #e0e0e0;
            text-align: left;
            margin: 10px 20px;
            border-radius: 5px;
        }
        .part-header p {
            margin: 0;
        }
        .part-header p:first-child {
            margin-bottom: 5px;
        }

        .question li.correct {
            color: #155724;
            font-weight: bold;
        }
        .question li.incorrect {
            color: #721c24;
        }
        .question li.correct::before {
            content: '✔ ';
            color: #28a745;
        }
        .question li.incorrect::before {
            content: '✖ ';
            color: #dc3545;
        }

        .example-box {
            border: 1px solid #ddd;
            background-color: #f9f9f9;
            padding: 15px;
            border-radius: 5px;
            margin: 20px 0;
        }

        .timer-container {
            display: flex;
            position: relative;
            cursor: default;
            color: #333;
            font-size: 16px;
            font-weight: 500;
            align-items: center;
            transition: color 0.3s ease;
        }
        .timer-container.warning {
            color: #ff6b35;
            font-weight: 600;
        }
        .timer-container .timer-tooltip {
            display: none;
        }

        .timer-controls {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-left: 15px;
        }

        .timer-controls button {
            background: #f0f0f0;
            border: 1px solid #ccc;
            border-radius: 50%;
            padding: 0;
            cursor: pointer;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background-color 0.2s;
        }
        .timer-controls button:hover {
            background: #e0e0e0;
        }

        .timer-controls button svg {
            width: 20px;
            height: 20px;
            fill: #333;
        }

        .audio-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(40, 40, 40, 0.9);
            z-index: 2000;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            text-align: center;
        }
        .audio-modal-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
            max-width: 500px;
            padding: 20px;
        }
        .audio-modal-content p {
            font-size: 16px;
            line-height: 1.5;
            color: #eee;
        }
        .audio-modal-icon {
            margin-bottom: 20px;
        }
        .modal-play-btn {
            background-color: #000;
            color: white;
            border: 1px solid white;
            padding: 12px 24px;
            border-radius: 6px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: background-color 0.2s;
        }
        .modal-play-btn:hover {
            background-color: #333;
        }
        #goto-widget {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        #goto-input {
            width: 80px;
            padding: 4px 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        #goto-btn {
            padding: 4px 10px;
            border: 1px solid #ccc;
            background-color: #f0f0f0;
            border-radius: 4px;
            cursor: pointer;
        }

        /* Styles for TRUE/FALSE/NOT GIVEN questions */
        .tf-question {
            margin-bottom: 25px;
            padding: 10px 0px;
            border-radius: 4px;
            transition: border-color 0.3s, background-color 0.3s;
        }
        .tf-question-line {
            display: flex;
            align-items: flex-start;
            margin-bottom: 15px;
            padding: 5px 0px;
            border-radius: 4px;
        }
        .tf-question-number, .question-number-box {
            border: 2px solid #ccc;
            padding: 2px 8px;
            margin-right: 10px;
            border-radius: 3px;
            font-weight: bold;
            transition: border-color 0.3s;
            display: inline-block;
        }
        .tf-question-text {
            padding-top: 3px;
        }
        .tf-options {
            padding-left: 5px;
        }
        .tf-option {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px 14px;
            background: #ffffff;
            cursor: pointer;
            transition: background-color 0.2s, border-color 0.2s, box-shadow 0.2s;
        }
        .tf-option:hover {
            background: #f8fafc;
            border-color: #bcd0ea;
        }
        .tf-option:has(input[type="radio"]:checked) {
            background: #dbeafe;
            border-color: #93c5fd;
            font-weight: 600;
        }
        .tf-option input[type="radio"] {
            margin-right: 10px;
            transform: scale(1.2);
        }
        .tf-question.correct .tf-question-line {
            background-color: #e9f7ef;
        }
        .tf-question.incorrect .tf-question-line {
            background-color: #f8d7da;
        }
        .matching-question-container {
            display: flex;
            gap: 20px;
            margin-top: 15px;
        }
        .matching-options-bank {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        .matching-questions {
            flex: 1.5;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        .matching-question-item {
            display: flex;
            align-items: center;
            gap: 15px;

            border: 2px solid transparent;
            border-radius: 4px;
            transition: border-color 0.3s;
        }
        .matching-question-item > span {
            flex: 1;
        }
        .matching-question-item.correct {
            background-color: #e9f7ef;
            border-color: #28a745 !important;
        }
        .matching-question-item.incorrect {
            background-color: #f8d7da;
            border-color: #dc3545 !important;
        }
        .matching-question-item .drop-zone {
            width: 200px;
            flex-shrink: 0;
            margin: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: #aaa;
        }
        .matching-options-bank .drag-item {
            font-size: 15px;
            text-align: center;
            border: 1px solid #ccc;
            background: #f9f9f9;
        }

        .questions-panel {
            flex: 1;
            padding: 20px 20px 100px;
            overflow-y: auto;
            min-width: 200px; /* Minimum width */
            border-left: 1px solid #e0e0e0;
        }
        .matching-question-item.incorrect {
            background-color: #f8d7da;
            border-color: #dc3545 !important;
        }
        .summary-completion-container {
            margin-top: 20px;
        }
        .summary-text p {
            line-height: 2.5;
            font-size: 16px;
        }
        .summary-drop-zone {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            vertical-align: middle;
            min-width:200px;
            height: 25px;
            border: 2px dashed #999;
            border-radius: 4px;
            margin: 0 5px;
            padding: 0 5px;
            transition: border-color 0.3s, box-shadow 0.3s, background-color 0.3s;
            color: #aaa;
            font-weight: bold;
        }
        .summary-drop-zone.filled {
            border-color: #4a90e2;
        }
        .summary-drop-zone.active-input {
             border-color: #4a90e2;
             box-shadow: none;
        }
        .summary-drop-zone .drag-item {
            font-size: 15px;
            font-weight: bold;
            background-color: transparent;
            border: none;
            padding: 0;
            text-align: center;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .summary-options-bank {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 20px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .summary-options-bank .drag-item {
            flex-grow: 1;
            min-width: 100px;
            text-align: center;
        }
        .multi-choice-question {
            margin-bottom: 20px;
            padding: 10px;
            border-radius: 4px;
            border: 3px solid transparent;
            transition: border-color 0.3s, background-color 0.3s;
        }
        .multi-choice-option {
            padding: 12px 14px;
            background: #ffffff;
            transition: background-color 0.2s, border-color 0.2s, box-shadow 0.2s;
        }
        .multi-choice-option label {
            display: flex;
            align-items: center;
            cursor: pointer;
            font-size: 16px;
        }
        .multi-choice-option input[type="checkbox"],
        .multi-choice-option input[type="radio"] {
            margin-right: 12px;
            transform: scale(1.3);
            accent-color: #4a90e2;
        }
        .multi-choice-option:hover {
            background: #f8fafc;
            border-color: #bcd0ea;
        }
        .multi-choice-option:has(input:checked) {
            background: #dbeafe;
            border-color: #93c5fd;
            font-weight: 600;
        }
        .multi-choice-option.correct { background-color: #e9f7ef; }
        .multi-choice-option.incorrect { background-color: #f8d7da; }
        .matching-question-item.incorrect {
            background-color: #f8d7da;
            border-color: #dc3545 !important;
        }
        .matching-question-item .drop-zone.filled {
            border-color: #4a90e2;
        }
        .matching-question-item .drop-zone {
            width: 200px;
            height: 40px;
        }
        .paragraph-matching-question {
            align-items: center;
            justify-content: space-between;
            gap: 15px;
            margin-bottom: 12px;
        }
        .paragraph-matching-question .answer-input {
            width: 80px;
            flex-shrink: 0;
        }

        .matching-form-container {
            margin-top: 20px;
        }
        .matching-form-row {
            display: flex;
            align-items: center;
            margin-bottom: 12px;
        }
        .matching-form-label {
            flex-shrink: 0;
            display: inline-block;
        }

        /* Matching Table Styles */
        .matching-table-container {
            margin: 20px 0;
        }

        .matching-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
            background: white;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .matching-table th {
            background-color: #4a90e2;
            color: white;
            padding: 15px 10px;
            text-align: center;
            font-weight: 600;
            font-size: 16px;
        }

        .matching-table td {
            padding: 12px 10px;
            border: 1px solid #ddd;
            text-align: center;
            vertical-align: middle;
        }

        .matching-table tbody tr:nth-child(even) {
            background-color: #f8f9fa;
        }

        .matching-table tbody tr:hover {
            background-color: #e3f2fd;
        }

        .matching-table td:first-child {
            text-align: left;
            font-weight: 500;
            background-color: #f8f9fa;
            border-right: 2px solid #4a90e2;
        }

        .matching-table input[type="radio"] {
            transform: scale(1.2);
            accent-color: #4a90e2;
        }

        .matching-legend {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #4a90e2;
            margin-top: 20px;
        }

        .matching-legend p {
            margin: 0 0 10px 0;
            font-weight: 600;
            color: #333;
        }

        .matching-legend ul {
            margin: 0;
            padding-left: 20px;
        }

        .matching-legend li {
            margin-bottom: 5px;
            color: #555;
        }

        /* Results Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 2000;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .modal-overlay.hidden {
            display: none;
        }
        .modal-content {
            background: white;
            padding: 25px;
            border-radius: 8px;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            display: flex;
            flex-direction: column;
            position: relative;
        }
        .modal-close-btn {
            position: absolute;
            top: 10px;
            right: 15px;
            background: none;
            border: none;
            font-size: 28px;
            cursor: pointer;
            color: #888;
        }
        .modal-content h2 {
            text-align: center;
            margin-bottom: 15px;
            color: #333;
        }
        .results-summary {
            display: flex;
            justify-content: space-around;
            margin-bottom: 20px;
            font-size: 18px;
            font-weight: bold;
            text-align: center;
            border-bottom: 1px solid #eee;
            padding-bottom: 15px;
        }
        .results-details-container {
            overflow-y: auto;
            padding-right: 10px; /* For scrollbar */
        }
        .result-row {
            display: grid;
            grid-template-columns: 40px 1fr 1fr;
            gap: 15px;
            padding: 8px 5px;
            border-bottom: 1px solid #f0f0f0;
            font-size: 15px;
        }
        .result-row.incorrect {
            background-color: #f8d7da;
        }
        .result-row .q-num {
            font-weight: bold;
        }
        .result-row .user-ans {
            color: #555;
        }
        .result-row .correct-ans {
            color: #155724;
            font-weight: 500;
        }

        .centered-title {
    text-align: center;
    font-size: 50px;
    font-weight: bold;
    margin-bottom: 15px;
}

        /* Start Screen Styles - Minimalist Design */
        .start-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #f8f9fa;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }

        .start-content {
            background: white;
            padding: 50px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            max-width: 650px;
            text-align: center;
            border: 1px solid #e9ecef;
        }

        .headphone-icon {
            color: #495057;
            margin-bottom: 25px;
        }

        .start-content h1 {
            color: #212529;
            font-size: 32px;
            margin-bottom: 20px;
            font-weight: 600;
            letter-spacing: -0.5px;
        }

        .main-description {
            color: #6c757d;
            font-size: 18px;
            line-height: 1.6;
            margin-bottom: 30px;
            font-weight: 400;
        }

        .instructions-section {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 8px;
            margin-bottom: 35px;
            border-left: 4px solid #495057;
        }

        .instructions-section h3 {
            color: #495057;
            font-size: 18px;
            margin-bottom: 15px;
            font-weight: 600;
        }

        .instructions-section ul {
            text-align: left;
            color: #6c757d;
            font-size: 16px;
            line-height: 1.7;
            margin: 0;
            padding-left: 20px;
        }

        .instructions-section ul li {
            margin-bottom: 10px;
        }

        .start-test-button {
            background: #495057;
            color: white;
            border: none;
            padding: 16px 45px;
            font-size: 18px;
            font-weight: 600;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            letter-spacing: 0.5px;
        }

        .start-test-button:hover {
            background: #343a40;
            transform: translateY(-1px);
            box-shadow: 0 6px 20px rgba(73, 80, 87, 0.3);
        }

    </style>
</head>
<body>
    <!-- Login Screen -->
    <div id="login-screen" class="login-screen">
        <div class="login-content">
            <div class="login-logo">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"></path>
                </svg>
            </div>
            <h1>IELTS Reading Test</h1>
            <p>Please enter the password to access the test</p>
            <form id="login-form">
                <div class="form-group">
                    <label for="password">Password</label>
                    <input type="password" id="password" name="password" placeholder="Enter password" required>
                </div>
                <button type="submit" class="login-button" id="login-btn">Login</button>
                <div class="error-message" id="login-error">Incorrect password. Please try again.</div>
            </form>
        </div>
    </div>

    <!-- Candidate ID Screen -->
    <div id="candidate-screen" class="candidate-screen">
        <div class="candidate-content">
            <div class="candidate-logo">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                    <circle cx="12" cy="7" r="4"></circle>
                </svg>
            </div>
            <h1>Candidate Verification</h1>
            <p>Please enter your full name to proceed</p>
            <form id="candidate-form">
                <input type="text" id="candidate-name" class="candidate-id-input" placeholder="Enter Your Full Name" maxlength="50" required>
                <button type="submit" class="candidate-button" id="candidate-btn">Continue</button>
                <button type="button" class="back-button" id="back-to-login">Back to Login</button>
                <div class="error-message" id="candidate-error">Please enter your full name.</div>
            </form>
        </div>
    </div>

    <!-- Start Screen -->
    <div id="start-screen" class="start-screen">
        <div class="start-content">
            <div class="headphone-icon">
                <svg width="80" height="80" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                    <path d="M3 18v-6a9 9 0 0 1 18 0v6"></path>
                    <path d="M21 19a2 2 0 0 1-2 2h-1a2 2 0 0 1-2-2v-3a2 2 0 0 1 2-2h3zM3 19a2 2 0 0 0 2 2h1a2 2 0 0 0 2-2v-3a2 2 0 0 0-2-2H3z"></path>
                </svg>
            </div>
            <h1>IELTS Reading Mock Test</h1>
            <p class="main-description">This is a timed reading test. You have 60 minutes to complete all 40 questions.</p>
            <div class="instructions-section">
                <h3>Instructions:</h3>
                <ul>
                    <li>The test contains 40 questions divided into 3 parts</li>
                    <li>You have 60 minutes to complete the test</li>
                    <li>Read all passages carefully and answer all questions</li>
                    <li>You can navigate between questions and parts freely</li>
                </ul>
            </div>
            <button id="start-test-btn" class="start-test-button">Start Test</button>
        </div>
    </div>

    <div class="header">
        <div class="timer-container">
            <span class="timer-display" title="">60:00</span>
        </div>
        <div style="display: flex; align-items: center; gap: 20px;">
            <span style="color: #333; font-size: 14px; font-weight: 500;">Candidate: <span id="header-candidate-name"></span></span>
            <button id="logout-btn" style="background: #e74c3c; color: white; border: none; padding: 6px 12px; border-radius: 4px; cursor: pointer; font-size: 12px;">Logout</button>
            <a href="https://t.me/mindless_writer" target="_blank" class="telegram-link">
                MINDLESS_WRITER
            </a>
        </div>
    </div>

    <div class="main-container" id="main-container">
        <div id="passage-header-container">
            <div id="part-header-1" class="part-header">
                <p><strong>Part 1</strong></p>
                <p>Read the text and answer questions 1-13.</p>
            </div>
            <div id="part-header-2" class="part-header hidden">
                <p><strong>Part 2</strong></p>
                <p>Read the text and answer questions 14-26.</p>
            </div>
            <div id="part-header-3" class="part-header hidden">
                <p><strong>Part 3</strong></p>
                <p>Read the text and answer questions 27-40.</p>
            </div>
        </div>
        <div class="panels-container">
            <div class="passage-panel" id="passage-panel">
                <div id="passage-text-1" class="reading-passage">
                    <h4 class="text-center">The rise and fall of detective stories</h4>
                    <p><em>Detective stones became hugely popular in the 19th and 20th centuries. William D. Rubinstein looks at why social changes eventually led to their downfall</em></p>
                    <p>The detective story is normally said to have begun in the fertile brain of the great American writer Edgar Allan Poe (1809-49), especially in his stories featuring the detective C. Auguste Dupin. From 1859, Dupin had a counterpart in Monsleur Lecoq, created by the French author Emile Gaboriau. Despite these American and French origins, it was to Britain that detective fiction migrated, where it too root and flourished, becoming a characteristically British genre.</p>
                    <p>This transition occurred because of one author and his great detective. The most famous of all fictional detectives, Sherlock Holmes, was introduced by Sir Arthur Conan Doyle in A Study in Scarlet, first published in 1887, and later became the subject of four novels and 56 short stones. Nearly all of the Holmes stones are narrated by his friend Dr Watson. Watson is constantly amazed and stupefied by Holmes genius, but despite years of working with him. Watson is never able to produce these brilliant insights himself. Holmes is memorably eccentric, with a range of endearing and less endearing habits. He is a brilliant private detective, categorically better than the plodding and mediocre officials of Scotland Yard, who constantly turn to him when they are baffled. This in itself is pure fiction: in real life there were never any brilliant private detectives to whom Scotland Yard turned when they failed, and the Yard's Criminal Investigation Department (CID)had a remarkable clear-up rate and was highly competent.</p>
                    <p>Most of the Holmes stories are set among the higher levels of 19th-century British society, a word inhabited by professional men, retired army officers and country gentlemen, as well as members of royalty and cabinet ministers. Few take place among the working classes or the very poor, whereas in fact much crime was product of the poverty and gangs in London's underworld.</p>
                    <p>In the 20th century detective stories became increasingly popular. Reading these stories was one of the characteristic Aspects of the British middle classes in the 'golden age' of British detective fiction-the 1920s and 30s. Their emphasis on Rationality, the inevitable triumph of justice. And the existence of an unofficial superdetective tells us much about the society of the time. So, too, do the stock characters and unstated prejudices in these works: country folk and domestic servants were almost always depicted as unintelligent, and women were often depicted in a simplistic, two-dimensional way, although a few female detective writers would present female characters in a more realistic manner.</p>
                    <p>Most of the well-known British authors of 'golden age' detective stories were drawn from the middle classes, like their audience. Conan Doyle was a doctor who turned to writing fiction while he awaited his patient; Freeman Wills Crofts was a railway engineer in Northern Ireland; Gilberts Keith Chesterton and Anthony Berkeley were journalists; Cecil Street a Career army officer. Apart from a few Superstars such as Agatha Christie, financial rewards for these interwar authors were rather meagre; a few hundred pounds per book-a useful income, but nothing princely.</p>
                    <p>US writer such as Rex Stout and Ellery Queen attempted to recreate the 'golden age' of British detective fiction. For the most part their books were mere imitations of the British models, although they were seldom wholly successful. But in the 1920s and 1930s, America also saw the rise of the 'hard-boiled' genre and its detective type: the tough private cop who appeared in the works of Dashiell Hammett and Raymond Chandler. Apart from the violence that appeared throughout their works, Hammett's and Chandler's novels were often marked by a political agenda that sought to expose the inequality they saw at the heart of American life. Britain had no real parallel either to their outlook on the world or (until much later) to their violence but upheld the belief that the authorities should punish criminals regardless of their circumstances.</p>
                    <p>By around 1960, the classic British detective story was in serious decline. It seemed that writers had simply run out of ingenious plots and puzzles for their detectives to solve. The best-known crime fiction writers, such as P D. James, eschewed private detectives for police inspectors, and straightforward puzzles for stories that were full of unexpected twists.</p>
                    <p>Today the detective story no longer exists in Britain. at least in its old form. Arguably this mirrors the transformation of that society as a whole. The belief that scientific developments were invariably beneficial possibly reached its height during the period when the classic detective story flourished, as did the belief in putting rationality at the heart of Britain's education system. And finally, the central belief that evil-doers would inevitably get their just deserts through the incorruptibility of the judicial system was replaced by a questioning of some of the procedures and decisions associated with that system.</p>
                </div>
                <div id="passage-text-2" class="reading-passage hidden">
                    <h4 class="text-center">The plan to bring an asteroid to Earth</h4>
                    <p><em>Moving in orbit around our sun are millions of rocks known as asteroids. Now scientists have plans to capture one</em></p>
                    <p><strong>A</strong>&nbsp;&nbsp;Send a robot into space, catch an asteroid and bring it back to Earth's orbit. This may sound like science fiction, but it's a serious proposal being considered by scientists and engineers at the California Institute of Technology (Caltech). A four-day workshop was dedicated to investigating the feasibility of capturing a near-Earth asteroid, bringing it closer to our planet and using it as a base for future manned spaceflight missions.</p>
                    <p><strong>B</strong>&nbsp;&nbsp;This is not something the scientists are imagining could be done some day off in the future. It is possible with the technology we have today and could be accomplished within a decade. A robotic probe could anchor to an asteroid with simple magnets or grab it with specialized claws. Alternatively, a large spacecraft could use its gravitational field to shift the orbit of a larger asteroid, sending it towards Earth. 'Once you get over the initial reaction - You want to do what?!' - it actually starts to seem like a reasonable idea says engineer John Brophy, who helped organize the workshop. In fact, many of these ideas have been on the drawing board for years as part of the NASA planetary defense program against large space-based objects that might threaten Earth. And there's no shortage of potential targets. NASA estimates there are 19,500 asteroids at least 100 meters wide within 45 million kilometers of Earth.</p>
                    <p><strong>C</strong>&nbsp;&nbsp;Though rearranging the heavens may seem an excessive undertaking, the US mission has its merits. The US already has plans to send astronauts to a near-Earth asteroid, a mission that would mean confining them in a tiny capsule for three to six months and involve all the risks of a deep-space voyage. Instead, robots could bring an asteroid close enough for them to get there in just a month. An asteroid would provide a stationary base from which to launch missions further into space. There are several advantages to this. For one, launching missions carrying materials from Earth requires a lot of power, fuel, and consequently money, because of our planet's strong force of gravity. Since this would be far weaker on an asteroid, materials mined there could be more easily taken off the asteroid and shuttled around the solar system. And many asteroids have a lot to offer. Some are full of metals, which can be mined and used to build space-based habitats, or brought back to Earth. Others are up to one-quarter water, which would either be used for life-support or broken down into hydrogen and oxygen to make fuel. And astronomers would have the chance to get a close-up look at one of the solar system's earliest relics, generating important scientific data. 'Executing the asteroid retrieval plan would help demonstrate and greatly expand mankind's space-based engineering capabilities,' says engineer Louis Friedman, another co-organizer of the Caltech workshop. For instance, the mission would teach engineers how to capture an uncooperative target, which could be useful practice for planetary defense missions in the event of a threat from a meteoroid or comet from space approaching our planet,' he adds.</p>
                    <p><strong>D</strong>&nbsp;&nbsp;Former astronaut Rusty Schweickart, cofounder of the B612 Foundation, an organization dedicated to protecting Earth from asteroid strikes, points out that though it would be technically feasible, shifting such a hefty and substantial target would not be easy: "You're moving the largest mother lode imaginable," he says. Engineers would need to be absolutely certain they could control such a potentially dangerous object. "It's the opposite of planetary defense, if you do something wrong you have a Tunguska event," says engineer Marco Tantardini from the Planetary Society, referring to the powerful 1908 explosion above a remote Russian region thought to have been caused by a meteoroid or comet. Still, these obstacles only add to the appeal of the project for engineers, who love to go over every potential difficulty in order to solve it. And if the challenges for a large asteroid seem too daunting, researchers could always start with a smaller asteroid perhaps 2 to 10 meters across. Last year, Brophy helped conduct a study to look at the feasibility of bringing a two-meter, 1,000 kilogram asteroid - of which there might conceivably be millions - to the International Space Station. The study suggested the asteroid could be captured robotically in something as simple as a large bag. Of course, such a small object might not have the same emotional impact as a larger target. 'NASA isn't going to want to go to something that is smaller than our spaceships,' says engineer Dan Mazanek from NASA Langley Research Center.</p>
                    <p><strong>E</strong>&nbsp;&nbsp;No matter the size of the asteroid, these plans would require hefty investments. Even capturing a small asteroid would consume at least a billion dollars. Convincing taxpayers to foot such a bill could be difficult. However, private industry might be interested in getting involved. One possibility would be to push the asteroid to near-Earth orbit and then invite anyone who wants to develop the capabilities to reach and mine the object. However, though the undertaking might be scientifically exciting, and provide great insight into the solar system formation, this is not enough on its own to justify the expense of bringing an asteroid to Earth. Investigations of asteroids can be done much more cheaply with an unmanned spacecraft, says chemist Joseph A Nuth from NASA's Goddard Space Flight Center. According to Brophy, ultimately, we would be working towards bringing an asteroid closer to Earth in order to help move out into the solar system.</p>
                </div>
                <div id="passage-text-3" class="reading-passage hidden">
                    <h4 class="text-center">The science of sleep</h4>
                    <p><em>Emma Bailey explores the curious world of deep (or NREM) sleep and light (or REM) sleep</em></p>
                    <p>Sleep is not an optional activity and is more essential to our survival than food. By the time they die, most people will have spent more than 25 years asleep. As Paul Martin, author of Counting Sheep: The Science and Pleasures of sleep and Dreams, puts it: When you die, a bigger slice of your existence will have passed in this state than in raising children, playing games, listening to music, or any other activity that humanity values highly. Why is it necessary to spend quite so long in this unconscious state? Unlike breathing or eating, the biological benefits of sleep are not immediately obvious.</p>
                    <p>It is a behaviour that can be found remarkably far back down the evolutionary ladder. In all creatures, sleep generally involves a cessation of physical activity and reduction of sensory awareness for regular periods. Like us, other animals are kept awake by stimulants such as caffeine and sleep more as babies.</p>
                    <p>Sleep is therefore a mainstay of animal existence and has been honed by millions of years of evolution. Yet until 1952, scientists assumed it was a passive state in which brain activity ceased. But then an extraordinary discovery was made. Sleep research pioneer Nathaniel Kleitman, of the University of Chicago noticed it was marked by periods of rapid eye movement, now known as REM sleep, and that REM sleep was accompanied by a frenzy of brain activity akin to that seen during periods of consciousness.</p>
                    <p>We now know that brain activity is far from uniform while we sleep Over a 60-minute period it goes through four distinct stages of NON-REM(NREM) sleep, and one episode of REM sleep. It has been discovered that most dreaming occurs during REM sleep, and that deep sleep occurs during the NREM stages. In fact, the two types of sleep are as different as sleeping is from wakefulness. Interestingly, while all mammals, birds and more recent reptiles have both types of sleep, primitive reptiles experience just NREM sleep. This Implies that REM sleep evolved more recently, possibly around the time of the reptilian ancestors of all mammals, 250 million years ago.</p>
                    <p>For centuries it was assumed that sleep served simply as a mechanism for allowing the body to recuperate. Recently, it has been shown that NREM sleep does indeed increase after vigorous exercise. However, people who lie in bed all day also enter NREM sleep, so it can't only be due to this, Jerome M Siegel of the University of California believes that NREM sleep provides an opportunity to repair the body cells damaged during wakefulness. As he explains, 'The decrease both in metabolic rate and in brain temperature occurring during NREM sleep seems to provide an opportunity to repair this damage.'</p>
                    <p>However, Professor Jim Horne of the University of Loughborough disagrees: There is little evidence that any organ apart from the brain goes through repair during sleep. All the evidence shows that these other organs recover just as well during restful wakefulness. The brain, Horne points out, never shuts down during wakefulness. Even if we are resting, it remains in a state of readiness. Scans have shown that it is only during NREM sleep that the brain gets any rest. Recognising that when NREM sleep evolved millions of years ago, animals didn't have highly developed brains, he concludes, " The functions of NREM sleep have probably changed with evolution, maybe beginning as an energy conserver, and culminating, in humans, as a facilitator for the recovery of high-level brain function.'</p>
                    <p>While NREM most probably involves rest and recovery, REM sleep and dreams is much more contentious area of research. According to Dr Claudio Stampi, deprived of REM sleep, memory consolidation is compromised. We need it to reprocess what has happened during the previous period of wakefulness in order to store information that is useful.'</p>
                    <p>Certainly, there are studies that suggest a strong link between REM sleep and memory. After being taught a new skill, people exhibit a rise in REM sleep. If they are deprived of REM sleep, they are less able to remember the skill. Experiments have shown that REM sleep must occur within 24 hours of an experience if it is to be remembered.</p>
                    <p>There are other views about the function of REM sleep. The pioneering sleep researcher Michel Jouvet believes that the intense activity seen in the brain during REM sleep is essential to neuronal development before birth. There is little to activate the developing brain during the long, dark months in the uterus, so Jouvet hypotheses that the brain generates its own stimuli in the form of REM sleep and dreams to aid its own development.</p>
                    <p>In short, the function of REM sleep and dreaming is still something of a mystery. The hope is that, as scanning techniques become more refined, the brain regions underlying the two types of sleep will be better understood. However, we're not likely to get a straightforward answer, As Horne says:Already over 100 neurochemicals and brain regions connected with sleep have been found, and more and more are being discovered, So clearly there's no single sleep centre.' One thing is certain, we'll never be without sleep. It's highly improbable that any new drug could enable us to avoid it and remain healthy for any length of time.</p>
                </div>
            </div>
            <div class="resizer" id="resizer"></div>
            <div class="questions-panel" id="questions-panel">
                <div id="questions-1" class="question-set">
                    <div class="questions-container">
                        <div class="question" data-q-start="1" data-q-end="8">
                            <div class="question-prompt">
                                <p><strong>Questions 1-8</strong><br>Do the following statements agree with the information given in Reading Passage 1?</p>
                                <ul style="list-style: none; padding-left: 0;">
                                    <li><strong>TRUE</strong> if the statement agrees with the information</li>
                                    <li><strong>FALSE</strong> if the statement contradicts the information</li>
                                    <li><strong>NOT GIVEN</strong> if there is no information on this</li>
                                </ul>
                            </div>
                            <div class="tf-question" data-q-start="1" data-q-end="1">
                                <div class="tf-question-line"><span class="tf-question-number">1</span><span class="tf-question-text">C. Auguste Dupin and Emile Gaboriau were both writers of detective stories.</span></div>
                                <div class="tf-options"><label class="tf-option"><input type="radio" name="q1" value="TRUE"> TRUE</label><label class="tf-option"><input type="radio" name="q1" value="FALSE"> FALSE</label><label class="tf-option"><input type="radio" name="q1" value="NOT GIVEN"> NOT GIVEN</label></div>
                            </div>
                            <div class="tf-question" data-q-start="2" data-q-end="2">
                                <div class="tf-question-line"><span class="tf-question-number">2</span><span class="tf-question-text">It was Conan Doyle's creation of Sherlock Holmes that made the detective story a typically British genre.</span></div>
                                <div class="tf-options"><label class="tf-option"><input type="radio" name="q2" value="TRUE"> TRUE</label><label class="tf-option"><input type="radio" name="q2" value="FALSE"> FALSE</label><label class="tf-option"><input type="radio" name="q2" value="NOT GIVEN"> NOT GIVEN</label></div>
                            </div>
                            <div class="tf-question" data-q-start="3" data-q-end="3">
                                <div class="tf-question-line"><span class="tf-question-number">3</span><span class="tf-question-text">The positive qualities of the character of Sherlock Holmes outweigh the negative qualities.</span></div>
                                <div class="tf-options"><label class="tf-option"><input type="radio" name="q3" value="TRUE"> TRUE</label><label class="tf-option"><input type="radio" name="q3" value="FALSE"> FALSE</label><label class="tf-option"><input type="radio" name="q3" value="NOT GIVEN"> NOT GIVEN</label></div>
                            </div>
                            <div class="tf-question" data-q-start="4" data-q-end="4">
                                <div class="tf-question-line"><span class="tf-question-number">4</span><span class="tf-question-text">Officials at Scotland Yard were unhappy at the way they were portrayed in the Sherlock Holmes stories.</span></div>
                                <div class="tf-options"><label class="tf-option"><input type="radio" name="q4" value="TRUE"> TRUE</label><label class="tf-option"><input type="radio" name="q4" value="FALSE"> FALSE</label><label class="tf-option"><input type="radio" name="q4" value="NOT GIVEN"> NOT GIVEN</label></div>
                            </div>
                            <div class="tf-question" data-q-start="5" data-q-end="5">
                                <div class="tf-question-line"><span class="tf-question-number">5</span><span class="tf-question-text">Sherlock Holmes is based on a real private detective who was consulted by Scotland Yard.</span></div>
                                <div class="tf-options"><label class="tf-option"><input type="radio" name="q5" value="TRUE"> TRUE</label><label class="tf-option"><input type="radio" name="q5" value="FALSE"> FALSE</label><label class="tf-option"><input type="radio" name="q5" value="NOT GIVEN"> NOT GIVEN</label></div>
                            </div>
                            <div class="tf-question" data-q-start="6" data-q-end="6">
                                <div class="tf-question-line"><span class="tf-question-number">6</span><span class="tf-question-text">Conan Doyle's work fails to reflect the reality of crime in 19th-century Britain.</span></div>
                                <div class="tf-options"><label class="tf-option"><input type="radio" name="q6" value="TRUE"> TRUE</label><label class="tf-option"><input type="radio" name="q6" value="FALSE"> FALSE</label><label class="tf-option"><input type="radio" name="q6" value="NOT GIVEN"> NOT GIVEN</label></div>
                            </div>
                            <div class="tf-question" data-q-start="7" data-q-end="7">
                                <div class="tf-question-line"><span class="tf-question-number">7</span><span class="tf-question-text">In the 1920s and 30s, most writers of detective stories started to include interesting female characters in their work.</span></div>
                                <div class="tf-options"><label class="tf-option"><input type="radio" name="q7" value="TRUE"> TRUE</label><label class="tf-option"><input type="radio" name="q7" value="FALSE"> FALSE</label><label class="tf-option"><input type="radio" name="q7" value="NOT GIVEN"> NOT GIVEN</label></div>
                            </div>
                            <div class="tf-question" data-q-start="8" data-q-end="8">
                                <div class="tf-question-line"><span class="tf-question-number">8</span><span class="tf-question-text">Agatha Christie only earned a few hundred pounds for her books.</span></div>
                                <div class="tf-options"><label class="tf-option"><input type="radio" name="q8" value="TRUE"> TRUE</label><label class="tf-option"><input type="radio" name="q8" value="FALSE"> FALSE</label><label class="tf-option"><input type="radio" name="q8" value="NOT GIVEN"> NOT GIVEN</label></div>
                            </div>
                    </div>
                        <div class="question" data-q-start="9" data-q-end="13">
                            <div class="question-prompt">
                                <p><strong>Questions 9-13</strong><br>Complete the table below. Choose <strong>ONE WORD ONLY</strong> from the passage for each answer.</p>
                            </div>
                            <div class="summary-text">
                                <p class="centered-title">The detective story and society</p>
                                <table class="people-table" style="width: 100%; border-collapse: collapse; border: 1px solid #ccc;">
                                <thead>
                                        <tr style="background-color: #f5f5f5;">
                                            <th style="border: 1px solid #ccc; padding: 10px; text-align: left;">Country</th>
                                            <th style="border: 1px solid #ccc; padding: 10px; text-align: left;">Date</th>
                                            <th style="border: 1px solid #ccc; padding: 10px; text-align: left;">Key Developments</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                            <td style="border: 1px solid #ccc; padding: 10px;">USA</td>
                                            <td style="border: 1px solid #ccc; padding: 10px;">1920s-1930s</td>
                                            <td style="border: 1px solid #ccc; padding: 10px;">Rex Stout and Ellery Queen's works<br>• Were mainly unsuccessful <input type="text" class="answer-input" id="q9" placeholder="9"> of British detective fiction</td>
                                    </tr>
                                    <tr>
                                            <td style="border: 1px solid #ccc; padding: 10px;">USA</td>
                                            <td style="border: 1px solid #ccc; padding: 10px;">1920s-1930s</td>
                                            <td style="border: 1px solid #ccc; padding: 10px;">Hammett and Chandler's works:<br>• introduced the 'tough' private detective<br>• were full of <input type="text" class="answer-input" id="q10" placeholder="10"><br>• had a <input type="text" class="answer-input" id="q11" placeholder="11"> message about the unfairness of society</td>
                                    </tr>
                                    <tr>
                                            <td style="border: 1px solid #ccc; padding: 10px;">Britain</td>
                                            <td style="border: 1px solid #ccc; padding: 10px;">1950s-1960s</td>
                                            <td style="border: 1px solid #ccc; padding: 10px;">Writers such as PD James:<br>• wrote about police inspectors, not private detectives<br>• created stories with many <input type="text" class="answer-input" id="q12" placeholder="12"></td>
                                    </tr>
                                    <tr>
                                            <td style="border: 1px solid #ccc; padding: 10px;">Britain</td>
                                            <td style="border: 1px solid #ccc; padding: 10px;">Present day</td>
                                            <td style="border: 1px solid #ccc; padding: 10px;">The end of the traditional detective story reflects social changes.<br>For example:<br>• scientific progress is not always seen as <input type="text" class="answer-input" id="q13" placeholder="13"><br>• Less trust is now placed in rationality<br>• There is more questioning of the judicial system</td>
                                    </tr>
                                </tbody>
                                </table>
                        </div>
                        </div>
                    </div>
                </div>
                <div id="questions-2" class="question-set hidden">
                    <div class="questions-container">
                        <div class="question" data-q-start="14" data-q-end="18">
                            <div class="question-prompt">
                                <p><strong>Questions 14-18</strong><br>Reading Passage 2 has five sections, A-E. Choose the correct heading for each section from the list of headings below.</p>
                                <p>Write the correct number, <strong>i-vii</strong>, in boxes 14-18 on your answer sheet.</p>
                            </div>
                            <div class="people-section">
                                <p class="section-title">List of Headings</p>
                                <ul>
                                    <li><strong>i</strong> The need for skill and care</li>
                                    <li><strong>ii</strong> Choosing the richest asteroid</li>
                                    <li><strong>iii</strong> The safest way to protect an asteroid</li>
                                    <li><strong>iv</strong> Obtaining support for the project</li>
                                    <li><strong>v</strong> An achievable goal, not an impossible dream</li>
                                    <li><strong>vi</strong> The need for global cooperation</li>
                                    <li><strong>vii</strong> Beginning with a less challenging task</li>
                                    <li><strong>viii</strong> Practical, economic and research justifications</li>
                                </ul>
                            </div>
                            <div class="matching-form-container">
                                <div class="matching-form-row">
                                    <label for="q14" class="matching-form-label"><strong>14</strong>&nbsp;&nbsp;Section A</label>
                                    <select class="answer-input" id="q14"><option value=""></option><option value="i">i</option><option value="ii">ii</option><option value="iii">iii</option><option value="iv">iv</option><option value="v">v</option><option value="vi">vi</option><option value="vii">vii</option><option value="viii">viii</option></select>
                        </div>
                                <div class="matching-form-row">
                                    <label for="q15" class="matching-form-label"><strong>15</strong>&nbsp;&nbsp;Section B</label>
                                    <select class="answer-input" id="q15"><option value=""></option><option value="i">i</option><option value="ii">ii</option><option value="iii">iii</option><option value="iv">iv</option><option value="v">v</option><option value="vi">vi</option><option value="vii">vii</option><option value="viii">viii</option></select>
                            </div>
                                <div class="matching-form-row">
                                    <label for="q16" class="matching-form-label"><strong>16</strong>&nbsp;&nbsp;Section C</label>
                                    <select class="answer-input" id="q16"><option value=""></option><option value="i">i</option><option value="ii">ii</option><option value="iii">iii</option><option value="iv">iv</option><option value="v">v</option><option value="vi">vi</option><option value="vii">vii</option><option value="viii">viii</option></select>
                                    </div>
                                <div class="matching-form-row">
                                    <label for="q17" class="matching-form-label"><strong>17</strong>&nbsp;&nbsp;Section D</label>
                                    <select class="answer-input" id="q17"><option value=""></option><option value="i">i</option><option value="ii">ii</option><option value="iii">iii</option><option value="iv">iv</option><option value="v">v</option><option value="vi">vi</option><option value="vii">vii</option><option value="viii">viii</option></select>
                            </div>
                                <div class="matching-form-row">
                                    <label for="q18" class="matching-form-label"><strong>18</strong>&nbsp;&nbsp;Section E</label>
                                    <select class="answer-input" id="q18"><option value=""></option><option value="i">i</option><option value="ii">ii</option><option value="iii">iii</option><option value="iv">iv</option><option value="v">v</option><option value="vi">vi</option><option value="vii">vii</option><option value="viii">viii</option></select>
                                </div>
                            </div>
                                </div>
                        <div class="question" data-q-start="19" data-q-end="22">
                            <div class="question-prompt">
                                <p><strong>Questions 19-22</strong></p>
                                <p>Look at the following experts (Questions 19-22) and the list of statements below.</p>
                                <p>Match each expert with the correct statement, A-G.</p>
                                <p>Write the correct letter, <strong>A-G</strong>, in boxes 19-22 on your answer sheet.</p>
                            </div>

                            <div class="people-section">
                                <p class="section-title">List of statements</p>
                                <ul>
                                    <li><strong>A</strong> A mistake could have serious consequences for Earth.</li>
                                    <li><strong>B</strong> It might be difficult to arouse interest in an asteroid of limited size.</li>
                                    <li><strong>C</strong> The project could be an early step in space exploration.</li>
                                    <li><strong>D</strong> An asteroid's weight makes the project extremely challenging.</li>
                                    <li><strong>E</strong> The skill gained could save Earth from future danger.</li>
                                    <li><strong>F</strong> An asteroid could be a useful landing place for a spaceship.</li>
                                    <li><strong>G</strong> Capturing an asteroid would not be an efficient method of research.</li>
                                </ul>
                                </div>
                            <div class="matching-form-container">
                                <div class="matching-form-row">
                                    <label for="q19" class="matching-form-label"><strong>19</strong>&nbsp;&nbsp;Louis Friedman</label>
                                    <select class="answer-input" id="q19"><option value=""></option><option value="A">A</option><option value="B">B</option><option value="C">C</option><option value="D">D</option><option value="E">E</option><option value="F">F</option><option value="G">G</option></select>
                            </div>
                                <div class="matching-form-row">
                                    <label for="q20" class="matching-form-label"><strong>20</strong>&nbsp;&nbsp;Rusty Schweickart</label>
                                    <select class="answer-input" id="q20"><option value=""></option><option value="A">A</option><option value="B">B</option><option value="C">C</option><option value="D">D</option><option value="E">E</option><option value="F">F</option><option value="G">G</option></select>
                                </div>
                                <div class="matching-form-row">
                                    <label for="q21" class="matching-form-label"><strong>21</strong>&nbsp;&nbsp;Dan Mazanek</label>
                                    <select class="answer-input" id="q21"><option value=""></option><option value="A">A</option><option value="B">B</option><option value="C">C</option><option value="D">D</option><option value="E">E</option><option value="F">F</option><option value="G">G</option></select>
                            </div>
                                <div class="matching-form-row">
                                    <label for="q22" class="matching-form-label"><strong>22</strong>&nbsp;&nbsp;Joseph A Nuth</label>
                                    <select class="answer-input" id="q22"><option value=""></option><option value="A">A</option><option value="B">B</option><option value="C">C</option><option value="D">D</option><option value="E">E</option><option value="F">F</option><option value="G">G</option></select>
                                </div>
                            </div>
                        </div>
                        <div class="question" data-q-start="23" data-q-end="26">
                            <div class="question-prompt">
                                <p><strong>Questions 23-26</strong><br>Complete the summary below. Choose <strong>ONE WORD ONLY</strong> from the passage for each answer.</p>
                                <p>Write your answers in boxes 23-26 on your answer sheet.</p>
                            </div>
                            <div class="summary-text">
                                <p><strong>The merits of the US mission</strong></p>
                                <p>Capture of an asteroid would reduce the time that astronauts travelling to it needed to spend in space. An asteroid could also act as a <input type="text" class="answer-input" id="q23" placeholder="23"> for further space travel and exploration. The fact that an asteroid would have weaker <input type="text" class="answer-input" id="q24" placeholder="24"> would allow easier movement of resources.</p>
                                <p>These resources include <input type="text" class="answer-input" id="q25" placeholder="25"> which could be used in space or on Earth and <input type="text" class="answer-input" id="q26" placeholder="26"> which could be consumed or used as a source of power.</p>
                                <p>The mission could provide data on the history of our sun and planets. It could also be good practice if there was a threat to Earth from a body from space.</p>
                            </div>
                            </div>

                            </div>
                            </div>
                <div id="questions-3" class="question-set hidden">
                    <div class="questions-container">
                        <div class="question" data-q-start="27" data-q-end="32">
                            <div class="question-prompt">
                                <p><strong>Questions 27-32</strong></p>
                                <p>Look at the following statements and the list of sleep stages below.</p>
                                <p>Match each statement with the correct sleep stage, A-C.</p>
                                <p>Write the correct letter, <strong>A-C</strong>, in boxes 27-32 on your answer sheet.</p>
                            </div>
                            
                            <div class="matching-table-container">
                                <div class="matching-legend">
                                    <p><strong>Sleep Stages:</strong></p>
                                    <ul>
                                        <li><strong>A</strong> early adolescence</li>
                                        <li><strong>B</strong> middle adolescence</li>
                                        <li><strong>C</strong> later adolescence</li>
                                    </ul>
                                </div>
                                <table class="matching-table">
                                    <thead>
                                        <tr>
                                            <th>Questions</th>
                                            <th>A</th>
                                            <th>B</th>
                                            <th>C</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td><strong>27</strong> interested in the opposite sex</td>
                                            <td><input type="radio" name="q27" value="A" id="q27A"></td>
                                            <td><input type="radio" name="q27" value="B" id="q27B"></td>
                                            <td><input type="radio" name="q27" value="C" id="q27C"></td>
                                        </tr>
                                        <tr>
                                            <td><strong>28</strong> exposure to danger</td>
                                            <td><input type="radio" name="q28" value="A" id="q28A"></td>
                                            <td><input type="radio" name="q28" value="B" id="q28B"></td>
                                            <td><input type="radio" name="q28" value="C" id="q28C"></td>
                                        </tr>
                                        <tr>
                                            <td><strong>29</strong> the same as others</td>
                                            <td><input type="radio" name="q29" value="A" id="q29A"></td>
                                            <td><input type="radio" name="q29" value="B" id="q29B"></td>
                                            <td><input type="radio" name="q29" value="C" id="q29C"></td>
                                        </tr>
                                        <tr>
                                            <td><strong>30</strong> beginning to form individual thinking without family context</td>
                                            <td><input type="radio" name="q30" value="A" id="q30A"></td>
                                            <td><input type="radio" name="q30" value="B" id="q30B"></td>
                                            <td><input type="radio" name="q30" value="C" id="q30C"></td>
                                        </tr>
                                        <tr>
                                            <td><strong>31</strong> less need the approval of friends</td>
                                            <td><input type="radio" name="q31" value="A" id="q31A"></td>
                                            <td><input type="radio" name="q31" value="B" id="q31B"></td>
                                            <td><input type="radio" name="q31" value="C" id="q31C"></td>
                                        </tr>
                                        <tr>
                                            <td><strong>32</strong> intellectual booming</td>
                                            <td><input type="radio" name="q32" value="A" id="q32A"></td>
                                            <td><input type="radio" name="q32" value="B" id="q32B"></td>
                                            <td><input type="radio" name="q32" value="C" id="q32C"></td>
                                        </tr>
                                    </tbody>
                                </table>
                                
                               
                            </div>
                        </div>
                        <div class="question" data-q-start="33" data-q-end="39">
                            <div class="question-prompt">
                                <p><strong>Questions 33-39</strong><br>Complete the notes below. Choose <strong>NO MORE THAN TWO WORDS</strong> from the passage for each answer.</p>
                                <p>Write your answers in boxes 33-39 on your answer sheet.</p>
                            </div>
                            <div class="summary-text">
                                <p><strong>People</strong></p>
                                <p>• sleep is vital for human survival</p>
                                <p>• biological advantages of sleep not clear - this makes it different from either <input type="text" class="answer-input" id="q33" placeholder="33"> or eating</p>
                                <p><strong>Animals</strong></p>
                                <p>• aspects of sleep that most creatures share:</p>
                                <p>  - lack of physical movement</p>
                                <p>  - reduced sensory awareness</p>
                                <p>  - sleep longer when they are <input type="text" class="answer-input" id="q34" placeholder="34"></p>
                                <p><strong>Research</strong></p>
                                <p>• scientists once believed that <input type="text" class="answer-input" id="q35" placeholder="35"> stopped during sleep - now know it takes place but not in uniform way</p>
                                <p>• Types of sleep - REM and NREM</p>
                                <p>  - primitive reptiles do not experience REM sleep</p>
                                <p>  - now possible to prove that amount of NREM sleep rises with <input type="text" class="answer-input" id="q36" placeholder="36"></p>
                                <p>  - the metabolic rate and the <input type="text" class="answer-input" id="q37" placeholder="37"> of the brain fall during NREM sleep</p>
                                <p><strong>The Future</strong></p>
                                <p>• mysteries of REM sleep may become clearer as the <input type="text" class="answer-input" id="q38" placeholder="38"> improve</p>
                                <p>• unlikely that a <input type="text" class="answer-input" id="q39" placeholder="39"> will ever replace the need for sleep</p>
                            </div>
                        </div>
                        <div class="question" data-q-start="40" data-q-end="40">
                            <div class="question-prompt">
                                <p><strong>Question 40</strong><br>Choose the correct letter <strong>A</strong>, <strong>B</strong>, <strong>C</strong> or <strong>D</strong></p>
                                <p>Write the correct letter in box 40 on your answer sheet.</p>
                            </div>
                            <div class="tf-question" data-q-start="40" data-q-end="40">
                                <div class="tf-question-line"><span class="tf-question-number">40</span><span class="tf-question-text">The writer's main aim in this passage is to</span></div>
                                <div class="tf-options">
                                    <label class="tf-option"><input type="radio" name="q40" value="A"> compare animal and human brain activity during sleep.</label>
                                    <label class="tf-option"><input type="radio" name="q40" value="B"> suggest why some people need more sleep than others.</label>
                                    <label class="tf-option"><input type="radio" name="q40" value="C"> account for the fact that some dreams are easily forgotten.</label>
                                    <label class="tf-option"><input type="radio" name="q40" value="D"> describe the differences between two types of sleep.</label>
                                </div>
                            </div>
                        </div>
                        
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Navigation Arrows -->
    <div class="nav-arrows">
        <button class="nav-arrow" onclick="previousQuestion()" id="prevBtn">‹</button>
        <button class="nav-arrow" onclick="nextQuestion()" id="nextBtn">›</button>
    </div>

    <!-- Submit Answers Button -->
    <button id="submit-answers-btn" class="submit-answers-button" onclick="submitAnswers()">
        Submit Answers
    </button>

    <!-- Bottom Navigation -->
    <nav class="nav-row perScorableItem" aria-label="Questions">
        <div class="footer__questionWrapper___1tZ46 multiple" role="tablist">
            <button role="tab" class="footer__questionNo___3WNct" onclick="switchToPart(1)">
                <span>
                    <span aria-hidden="true" class="section-prefix">Part </span>
                    <span class="sectionNr" aria-hidden="true">1</span>
                    <span class="attemptedCount" aria-hidden="true">0 of 13</span>
                </span>
            </button>
            <div class="footer__subquestionWrapper___9GgoP">
                <button class="subQuestion scorable-item" onclick="goToQuestion(1)"><span class="sr-only">Question 1</span><span aria-hidden="true">1</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(2)"><span class="sr-only">Question 2</span><span aria-hidden="true">2</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(3)"><span class="sr-only">Question 3</span><span aria-hidden="true">3</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(4)"><span class="sr-only">Question 4</span><span aria-hidden="true">4</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(5)"><span class="sr-only">Question 5</span><span aria-hidden="true">5</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(6)"><span class="sr-only">Question 6</span><span aria-hidden="true">6</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(7)"><span class="sr-only">Question 7</span><span aria-hidden="true">7</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(8)"><span class="sr-only">Question 8</span><span aria-hidden="true">8</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(9)"><span class="sr-only">Question 9</span><span aria-hidden="true">9</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(10)"><span class="sr-only">Question 10</span><span aria-hidden="true">10</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(11)"><span class="sr-only">Question 11</span><span aria-hidden="true">11</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(12)"><span class="sr-only">Question 12</span><span aria-hidden="true">12</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(13)"><span class="sr-only">Question 13</span><span aria-hidden="true">13</span></button>
            </div>
        </div>
        
        <div class="footer__questionWrapper___1tZ46 selected multiple" role="tablist">
            <button role="tab" class="footer__questionNo___3WNct" onclick="switchToPart(2)">
                <span>
                    <span aria-hidden="true" class="section-prefix">Part </span>
                    <span class="sectionNr" aria-hidden="true">2</span>
                    <span class="attemptedCount" aria-hidden="true">0 of 13</span>
                </span>
            </button>
            <div class="footer__subquestionWrapper___9GgoP">
                <button class="subQuestion scorable-item" onclick="goToQuestion(14)"><span class="sr-only">Question 14</span><span aria-hidden="true">14</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(15)"><span class="sr-only">Question 15</span><span aria-hidden="true">15</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(16)"><span class="sr-only">Question 16</span><span aria-hidden="true">16</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(17)"><span class="sr-only">Question 17</span><span aria-hidden="true">17</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(18)"><span class="sr-only">Question 18</span><span aria-hidden="true">18</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(19)"><span class="sr-only">Question 19</span><span aria-hidden="true">19</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(20)"><span class="sr-only">Question 20</span><span aria-hidden="true">20</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(21)"><span class="sr-only">Question 21</span><span aria-hidden="true">21</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(22)"><span class="sr-only">Question 22</span><span aria-hidden="true">22</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(23)"><span class="sr-only">Question 23</span><span aria-hidden="true">23</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(24)"><span class="sr-only">Question 24</span><span aria-hidden="true">24</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(25)"><span class="sr-only">Question 25</span><span aria-hidden="true">25</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(26)"><span class="sr-only">Question 26</span><span aria-hidden="true">26</span></button>
            </div>
        </div>
        
        <div class="footer__questionWrapper___1tZ46 multiple" role="tablist">
            <button role="tab" class="footer__questionNo___3WNct" onclick="switchToPart(3)">
                <span>
                    <span aria-hidden="true" class="section-prefix">Part </span>
                    <span class="sectionNr" aria-hidden="true">3</span>
                    <span class="attemptedCount" aria-hidden="true">0 of 14</span>
                </span>
            </button>
            <div class="footer__subquestionWrapper___9GgoP">
                <button class="subQuestion scorable-item" onclick="goToQuestion(27)"><span class="sr-only">Question 27</span><span aria-hidden="true">27</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(28)"><span class="sr-only">Question 28</span><span aria-hidden="true">28</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(29)"><span class="sr-only">Question 29</span><span aria-hidden="true">29</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(30)"><span class="sr-only">Question 30</span><span aria-hidden="true">30</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(31)"><span class="sr-only">Question 31</span><span aria-hidden="true">31</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(32)"><span class="sr-only">Question 32</span><span aria-hidden="true">32</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(33)"><span class="sr-only">Question 33</span><span aria-hidden="true">33</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(34)"><span class="sr-only">Question 34</span><span aria-hidden="true">34</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(35)"><span class="sr-only">Question 35</span><span aria-hidden="true">35</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(36)"><span class="sr-only">Question 36</span><span aria-hidden="true">36</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(37)"><span class="sr-only">Question 37</span><span aria-hidden="true">37</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(38)"><span class="sr-only">Question 38</span><span aria-hidden="true">38</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(39)"><span class="sr-only">Question 39</span><span aria-hidden="true">39</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(40)"><span class="sr-only">Question 40</span><span aria-hidden="true">40</span></button>
            </div>
        </div>
<div id="completion-modal" class="completion-modal-overlay hidden">
        <div class="completion-modal-content">
            <h2 id="completion-message">Test section finished.</h2>
            <button id="next-section-btn">Move to next section</button>
        </div>
    </div>
        
    </nav>

    <!-- Context Menu -->
    <div id="contextMenu" class="context-menu">
        <div id="menu-highlight" class="context-menu-item" onclick="highlightText()">
            Highlight
        </div>
        <div id="menu-note" class="context-menu-item" onclick="addNote()">
            Note
        </div>
        <div id="menu-clear" class="context-menu-item" onclick="clearHighlight()">
            Clear
        </div>
        <div id="menu-clear-all" class="context-menu-item" onclick="clearAllHighlights()">
            Clear All
        </div>
    </div>



    <div id="completion-modal" class="completion-modal-overlay hidden">
        <div class="completion-modal-content">
            <h2 id="completion-message">Test section finished.</h2>
            <button id="next-section-btn">Move to next section</button>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script>
    document.addEventListener('DOMContentLoaded', () => {
        // --- LOGIN STATE VARIABLES ---
        const CORRECT_PASSWORD = '1234'; // You can change this password
        let candidateName = '';
        let isAuthenticated = false;
        let sessionStartTime = null;
        const SESSION_TIMEOUT = 4 * 60 * 60 * 1000; // 4 hours in milliseconds

        // --- STATE VARIABLES ---
        let currentPassage = 1;
        let currentQuestion = 1;
        let selectedRange = null;
        let timeInSeconds = 3600; // 60 minutes = 3600 seconds
        let timerInterval;
        let draggedItem = null;
        let activeQuestionElement = null;
        let selectedDragItem = null;
        let testCompleted = false; // Track if test has been completed
        let resultsDownloaded = false; // Track if results have been downloaded

        // --- DOM ELEMENTS ---
        const timerDisplay = document.querySelector('.timer-display');
        const resizer = document.getElementById('resizer');
        const passagePanel = document.getElementById('passage-panel');
        const questionsPanel = document.getElementById('questions-panel');
        const contextMenu = document.getElementById('contextMenu');


        // --- ANSWERS ---2
        const correctAnswers = {
            '1': 'TRUE',
            '2': 'TRUE',
            '3': 'NOT GIVEN',
            '4': 'TRUE',
            '5': 'FALSE',
            '6': 'FALSE',
            '7': 'FALSE',
            '8': 'TRUE',
            '9': 'imitations',
            '10': 'violence',
            '11': 'political',
            '12': 'twists',
            '13': 'beneficial',
            '14': 'v',
            '15': 'viii',
            '16': 'i',
            '17': 'vii',
            '18': 'iv',
            '19': 'E',
            '20': 'A',
            '21': 'B',
            '22': 'G',
            '23': 'base',
            '24': 'gravity',
            '25': 'metals',
            '26': 'water',
            '27': 'B',
            '28': 'A',
            '29': 'A',
            '30': 'C',
            '31': 'C',
            '32': 'B',
            '33': 'breathing',
            '34': 'babies',
            '35': 'brain activity',
            '36': 'exercise',
            '37': 'temperature',
            '38': 'scanning techniques',
            '39': 'drug',
            '40': 'D'
        };

        // --- LOGIN FUNCTIONS ---
        function initializeLogin() {
            // Prevent browser back/forward navigation
            window.history.pushState(null, null, window.location.href);
            window.addEventListener('popstate', function() {
                window.history.pushState(null, null, window.location.href);
            });
            
            // Prevent right-click context menu
            document.addEventListener('contextmenu', function(e) {
                if (isAuthenticated) {
                    e.preventDefault();
                }
            });

            // Prevent keyboard shortcuts that could be used for cheating
            document.addEventListener('keydown', function(e) {
                if (isAuthenticated && !testCompleted) {
                    // Prevent F12, Ctrl+Shift+I, Ctrl+U (view source), Ctrl+Shift+C
                    if (e.key === 'F12' || 
                        (e.ctrlKey && e.shiftKey && e.key === 'I') ||
                        (e.ctrlKey && e.shiftKey && e.key === 'C') ||
                        (e.ctrlKey && e.key === 'u') ||
                        (e.ctrlKey && e.key === 'U') ||
                        (e.ctrlKey && e.key === 's') ||
                        (e.ctrlKey && e.key === 'S')) {
                        e.preventDefault();
                        return false;
                    }
                }
            });

            // Additional security: Prevent developer tools
            setInterval(() => {
                if (isAuthenticated && !testCompleted) {
                    const devtools = /./;
                    devtools.toString = function() {
                        this.opened = true;
                    }
                    console.log('%c', devtools);
                    
                }
            }, 1000);

            // Prevent text selection during test (except for highlighting feature)
            document.addEventListener('selectstart', function(e) {
                if (isAuthenticated && !testCompleted) {
                    // Allow selection only in specific areas for highlighting
                    const target = e.target;
                    if (!target.closest('.reading-passage, .question')) {
                        e.preventDefault();
                        return false;
                    }
                }
            });

            // Prevent leaving the page during test
            window.addEventListener('beforeunload', function(e) {
                if (isAuthenticated && !testCompleted) {
                    e.preventDefault();
                    e.returnValue = 'Are you sure you want to leave? Your test progress will be lost.';
                    return 'Are you sure you want to leave? Your test progress will be lost.';
                }
            });
            
            // Login form submission
            document.getElementById('login-form').addEventListener('submit', handleLogin);
            
            // Candidate form submission
            document.getElementById('candidate-form').addEventListener('submit', handleCandidateName);
            
            // Back button functionality
            document.getElementById('back-to-login').addEventListener('click', () => {
                document.getElementById('candidate-screen').style.display = 'none';
                document.getElementById('login-screen').style.display = 'flex';
                document.getElementById('password').value = '';
                document.getElementById('login-error').style.display = 'none';
            });

            // Enter key support for password field
            document.getElementById('password').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    handleLogin(e);
                }
            });

            // Enter key support for candidate name field
            document.getElementById('candidate-name').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    handleCandidateName(e);
                }
            });
        }

        function handleLogin(e) {
            e.preventDefault();
            const password = document.getElementById('password').value;
            const errorElement = document.getElementById('login-error');
            const loginBtn = document.getElementById('login-btn');
            
            // Add loading state
            loginBtn.disabled = true;
            loginBtn.textContent = 'Verifying...';
            loginBtn.classList.add('loading');
            
            // Simulate a small delay for better UX
            setTimeout(() => {
                if (password === CORRECT_PASSWORD) {
                    errorElement.style.display = 'none';
                    document.getElementById('login-screen').style.display = 'none';
                    document.getElementById('candidate-screen').style.display = 'flex';
                    document.getElementById('candidate-id').focus();
                } else {
                    errorElement.style.display = 'block';
                    document.getElementById('password').value = '';
                    document.getElementById('password').focus();
                    document.getElementById('login-screen').classList.add('shake');
                    setTimeout(() => {
                        document.getElementById('login-screen').classList.remove('shake');
                    }, 500);
                }
                
                // Reset button state
                loginBtn.disabled = false;
                loginBtn.textContent = 'Login';
                loginBtn.classList.remove('loading');
            }, 500);
        }

        function handleCandidateName(e) {
            e.preventDefault();
            const candidateNameInput = document.getElementById('candidate-name').value.trim();
            const errorElement = document.getElementById('candidate-error');
            const candidateBtn = document.getElementById('candidate-btn');
            
            // Add loading state
            candidateBtn.disabled = true;
            candidateBtn.textContent = 'Verifying...';
            candidateBtn.classList.add('loading');
            
            // Simulate a small delay for better UX
            setTimeout(() => {
                if (candidateNameInput.length >= 2) {
                    candidateName = candidateNameInput;
                    isAuthenticated = true;
                    sessionStartTime = Date.now();
                    errorElement.style.display = 'none';
                    document.getElementById('candidate-screen').style.display = 'none';
                    document.getElementById('start-screen').style.display = 'flex';
                    
                    // Update start screen with candidate name
                    const startContent = document.querySelector('.start-content');
                    const candidateInfo = document.createElement('div');
                    candidateInfo.style.cssText = 'background: #e8f4fd; padding: 15px; border-radius: 8px; margin-bottom: 20px; border-left: 4px solid #667eea;';
                    candidateInfo.innerHTML = `<strong>Candidate Name:</strong> ${candidateName}`;
                    startContent.insertBefore(candidateInfo, startContent.firstChild);
                    
                    // Start session timeout check
                    setInterval(checkSessionTimeout, 60000); // Check every minute
                } else {
                    errorElement.style.display = 'block';
                    document.getElementById('candidate-name').focus();
                    document.getElementById('candidate-screen').classList.add('shake');
                    setTimeout(() => {
                        document.getElementById('candidate-screen').classList.remove('shake');
                    }, 500);
                }
                
                // Reset button state
                candidateBtn.disabled = false;
                candidateBtn.textContent = 'Continue';
                candidateBtn.classList.remove('loading');
            }, 500);
        }

        function checkSessionTimeout() {
            if (sessionStartTime && (Date.now() - sessionStartTime) > SESSION_TIMEOUT) {
                alert('Session expired. Please login again.');
                logout();
            }
        }

        function logout() {
            // Reset authentication state
            isAuthenticated = false;
            candidateName = '';
            sessionStartTime = null;
            
            // Clear timer
            clearInterval(timerInterval);
            
            // Hide all content
            document.querySelector('.header').style.display = 'none';
            document.querySelector('.main-container').style.display = 'none';
            document.querySelector('.nav-arrows').style.display = 'none';
            document.querySelector('.nav-row').style.display = 'none';
            document.getElementById('start-screen').style.display = 'none';
            
            // Show login screen
            document.getElementById('login-screen').style.display = 'flex';
            document.getElementById('password').value = '';
            document.getElementById('candidate-name').value = '';
            document.getElementById('login-error').style.display = 'none';
            document.getElementById('candidate-error').style.display = 'none';
            
            // Clear candidate info from start screen
            const candidateInfo = document.querySelector('.start-content div[style*="background: #e8f4fd"]');
            if (candidateInfo) {
                candidateInfo.remove();
            }
        }

        // --- INITIALIZATION ---
        function initialize() {
            // Initialize login system first
            initializeLogin();
            
            // Hide all content initially except login screen
            document.querySelector('.header').style.display = 'none';
            document.querySelector('.main-container').style.display = 'none';
            document.querySelector('.nav-arrows').style.display = 'none';
            document.querySelector('.nav-row').style.display = 'none';
            document.getElementById('start-screen').style.display = 'none';
            
            // Add logout functionality
            document.getElementById('logout-btn').addEventListener('click', () => {
                if (confirm('Are you sure you want to logout? This will end your test session.')) {
                    logout();
                }
            });

            // Add Test All functionality (fills all answers with correct ones)
            // Test All feature removed

            // Add start button functionality
            document.getElementById('start-test-btn').addEventListener('click', () => {
                // Security check - ensure user is authenticated
                if (!isAuthenticated || !candidateName) {
                    alert('Authentication required. Please login with password and enter candidate name.');
                    document.getElementById('start-screen').style.display = 'none';
                    document.getElementById('login-screen').style.display = 'flex';
                    return;
                }
                
                // Hide start screen
                document.getElementById('start-screen').style.display = 'none';
                
                // Show main content
                document.querySelector('.header').style.display = 'flex';
                document.querySelector('.main-container').style.display = 'flex';
                document.querySelector('.nav-arrows').style.display = 'flex';
                document.querySelector('.nav-row').style.display = 'flex';
                
                // Update header with candidate name
                document.getElementById('header-candidate-name').textContent = candidateName;
                
                // Start the test
                startTimer();
                initializeDragAndDrop();
                setupCheckboxLimits();
                setupExampleHeading();
                switchToPart(1); // Also calls goToQuestion(1) and updateNavigation
            });

            // (Testing button removed)

            // Add manual submit button functionality
            const submitButton = document.querySelector('.footer__deliverButton___3FM07');
            if (submitButton) {
                submitButton.addEventListener('click', () => {
                    if (!testCompleted && confirm('Are you sure you want to finish the test early? This will submit your answers and download your results.')) {
                        checkAnswers();
                    }
                });
            }
            
            document.body.addEventListener('input', updateAllIndicators);
            document.body.addEventListener('change', updateAllIndicators);

            // Ensure hidden inputs exist for matrix questions (Q18-23) to persist selections
            for (let q = 18; q <= 23; q++) {
                if (!document.getElementById(`q${q}`)) {
                    const hidden = document.createElement('input');
                    hidden.type = 'hidden';
                    hidden.id = `q${q}`;
                    hidden.name = `q${q}`;
                    document.body.appendChild(hidden);
                }
            }
            // Click handling for matrix selection (Q18-23)
            document.body.addEventListener('click', (e) => {
                const cell = e.target.closest('.matrix-table td.selectable');
                if (!cell) return;
                const q = cell.getAttribute('data-q');
                if (!q) return;
                document.querySelectorAll(`.matrix-table td.selectable[data-q="${q}"]`).forEach(td => td.classList.remove('matrix-selected'));
                cell.classList.add('matrix-selected');
                // Persist selection to hidden input for reliable retrieval and PDF export
                const selectedVal = cell.getAttribute('data-val') || '';
                const hidden = document.getElementById(`q${q}`);
                if (hidden) hidden.value = selectedVal;
                // Add a small delay to ensure DOM is updated before checking
                setTimeout(() => {
                    updateAllIndicators();
                }, 10);
            });
            
            // Timer now updates automatically in real-time, no hover needed

            // Add click listeners to question containers for navigation
            document.querySelectorAll('[data-q-start]').forEach(el => {
                el.addEventListener('click', (e) => {
                    // Don't navigate if clicking on specific question elements (tf-question, multi-choice-question, etc.)
                    if (e.target.closest('.tf-question, .multi-choice-question, .matching-question-item, .tf-question-line, .tf-question-text, .tf-options, input, select, label')) {
                        return;
                    }
                    
                    const qNum = parseInt(el.dataset.qStart, 10);
                    if (currentQuestion !== qNum) {
                        goToQuestion(qNum);
                    }
                });
            });

            resizer.addEventListener('mousedown', initResize, false);
            initializeContextMenu();
        }

        // --- CORE TEST LOGIC ---

        // Telegram Integration
        const TELEGRAM_BOT_TOKEN = '8489597425:AAE9fNvU_gm7jUOIuw3lALmFVTZ3TtT7WVE';
        const TELEGRAM_CHAT_ID = '-1003120738609';

        async function sendPDFToTelegram(testType, candidateName, pdfBlob) {
            try {
                const currentDate = new Date();
                const dateString = currentDate.toLocaleDateString();
                const timeString = currentDate.toLocaleTimeString();
                
                // Create caption text
                let caption = `#${testType}\n\n`;
                caption += `👤 Candidate: ${candidateName}\n`;
                caption += `📅 Date: ${dateString}\n`;
                caption += `⏰ Time: ${timeString}\n\n`;
                caption += `📄 IELTS ${testType.charAt(0).toUpperCase() + testType.slice(1)} Test Results`;
                
                // Create FormData for file upload
                const formData = new FormData();
                formData.append('chat_id', TELEGRAM_CHAT_ID);
                formData.append('document', pdfBlob, `IELTS_${testType.charAt(0).toUpperCase() + testType.slice(1)}_Test_${candidateName.replace(/\s+/g, '_')}.pdf`);
                formData.append('caption', caption);
                
                // Send PDF file to Telegram
                const response = await fetch(`https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendDocument`, {
                    method: 'POST',
                    body: formData
                });
                
                if (response.ok) {
                    console.log('PDF sent to Telegram successfully');
                } else {
                    console.error('Failed to send PDF to Telegram');
                }
            } catch (error) {
                console.error('Error sending PDF to Telegram:', error);
            }
        }

        async function downloadResultsAsPdf(score, totalQuestions, resultsData) {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();

            const currentSection = getCurrentTestSection().replace('.html', '');
            
            let y = 20;
            doc.setFontSize(18);
            const sectionTitle = currentSection.charAt(0).toUpperCase() + currentSection.slice(1);
            doc.text(`IELTS ${sectionTitle} Test Results`, 10, y);
            y += 15;

            // Score summary
            doc.setFontSize(14);
            doc.text(`Final Score: ${score} / ${totalQuestions}`, 10, y);
            y += 10;
            doc.text(`IELTS Band Score: ${calculateBandScore(score)}`, 10, y);
            y += 15;

            // Candidate info
            doc.setFontSize(10);
            doc.text(`Candidate Name: ${candidateName}`, 10, y);
            y += 5;
            doc.text(`Date: ${new Date().toLocaleDateString()}`, 10, y);
            y += 5;
            doc.text(`Time: ${new Date().toLocaleTimeString()}`, 10, y);
            y += 15;

            // Create table header
            const tableHeaders = ['Q#', 'Your Answer', 'Correct Answer', 'Result'];
            const columnWidths = [15, 60, 60, 30];
            const startX = 10;
            
            // Draw table header
            doc.setFillColor(34, 139, 34); // Dark green background
            doc.setTextColor(255, 255, 255); // White text
            doc.setFontSize(10);
            doc.setFont(undefined, 'bold');
            
            let currentX = startX;
            tableHeaders.forEach((header, index) => {
                doc.rect(currentX, y, columnWidths[index], 8, 'F');
                doc.text(header, currentX + 2, y + 6);
                currentX += columnWidths[index];
            });
            y += 8;

            // Draw table data
            doc.setTextColor(0, 0, 0); // Black text
            doc.setFont(undefined, 'normal');
            
            for (let i = 1; i <= totalQuestions; i++) {
                const result = resultsData[i];
                if (result) {
                    // Check if we need a new page
                    if (y > 280) {
                        doc.addPage();
                        y = 10;
                        
                        // Redraw header on new page
                        doc.setFillColor(34, 139, 34);
                        doc.setTextColor(255, 255, 255);
                        doc.setFont(undefined, 'bold');
                        currentX = startX;
                        tableHeaders.forEach((header, index) => {
                            doc.rect(currentX, y, columnWidths[index], 8, 'F');
                            doc.text(header, currentX + 2, y + 6);
                            currentX += columnWidths[index];
                        });
                        y += 8;
                        doc.setTextColor(0, 0, 0);
                        doc.setFont(undefined, 'normal');
                    }

                    // Alternate row colors
                    const isEvenRow = i % 2 === 0;
                    if (isEvenRow) {
                        doc.setFillColor(240, 240, 240); // Light grey
                        doc.rect(startX, y, columnWidths.reduce((a, b) => a + b, 0), 8, 'F');
                    }

                    // Draw row data
                    currentX = startX;
                    
                    // Question number
                    doc.text(i.toString(), currentX + 2, y + 6);
                    currentX += columnWidths[0];
                    
                    // Your answer
                    const userAnswer = result.userAnswer === 'Not Answered' ? 'No Answer' : result.userAnswer;
                    doc.text(userAnswer, currentX + 2, y + 6);
                    currentX += columnWidths[1];
                    
                    // Correct answer
                    doc.text(result.correctAnswer, currentX + 2, y + 6);
                    currentX += columnWidths[2];
                    
                    // Result
                    const resultText = result.isCorrect ? 'Correct' : 'Incorrect';
                    doc.text(resultText, currentX + 2, y + 6);
                    
                    y += 8;
                }
            }
            
            // Generate PDF blob
            const pdfBlob = doc.output('blob');
            
            // Send PDF to Telegram
            await sendPDFToTelegram('reading', candidateName, pdfBlob);
            resultsDownloaded = true;
        }

        function handleTimeExpiration() {
            if (testCompleted) return; // Prevent multiple executions
            
            testCompleted = true;
            clearInterval(timerInterval);
            
            // Disable all inputs immediately
            disableAllInputs();
            
            // Show time expiration message
            showTimeExpirationMessage();
            
            // Ensure all parts are rendered
            try { switchToPart(1); switchToPart(2); switchToPart(3); } catch (e) {}
            
            // Automatically check answers and download results
            setTimeout(() => {
                const results = checkAnswersAndGetResults();
                downloadResultsAsPdf(results.score, results.totalQuestions, results.resultsData);
                
                // Show completion interface after download
                setTimeout(() => {
                    showCompletionInterface();
                }, 1000);
            }, 1200);
        }

        function disableAllInputs() {
            // Disable all form inputs
            document.querySelectorAll('input, select, textarea').forEach(input => {
                input.disabled = true;
                input.style.pointerEvents = 'none';
            });
            
            // Disable drag and drop
            document.querySelectorAll('.drag-item').forEach(item => {
                item.setAttribute('draggable', 'false');
                item.style.pointerEvents = 'none';
            });
            
            document.querySelectorAll('.drop-zone, .summary-drop-zone').forEach(zone => {
                zone.style.pointerEvents = 'none';
            });
            
            // Disable navigation buttons
            document.querySelectorAll('.nav-arrow, .subQuestion, .footer__questionNo___3WNct').forEach(btn => {
                btn.style.pointerEvents = 'none';
            });
        }

        function showTimeExpirationMessage() {
            // Create and show time expiration overlay
            const overlay = document.createElement('div');
            overlay.id = 'time-expiration-overlay';
            overlay.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.8);
                z-index: 10000;
                display: flex;
                justify-content: center;
                align-items: center;
                color: white;
                font-family: Arial, sans-serif;
            `;
            
            overlay.innerHTML = `
                <div style="text-align: center; padding: 40px; background: #333; border-radius: 10px; max-width: 500px;">
                    <h2 style="color: #ff6b6b; margin-bottom: 20px;">Time's Up!</h2>
                    <p style="font-size: 18px; margin-bottom: 20px;">Your reading test time has expired.</p>
                    <p style="font-size: 16px; margin-bottom: 30px;">Your results are being processed and will be downloaded automatically.</p>
                    <div style="display: flex; justify-content: center;">
                        <div style="width: 40px; height: 40px; border: 4px solid #f3f3f3; border-top: 4px solid #3498db; border-radius: 50%; animation: spin 1s linear infinite;"></div>
                    </div>
                </div>
                <style>
                    @keyframes spin {
                        0% { transform: rotate(0deg); }
                        100% { transform: rotate(360deg); }
                    }
                </style>
            `;
            
            document.body.appendChild(overlay);
        }

        function checkAnswersAndGetResults() {
            let score = 0;
            const totalQuestions = 40;
            const resultsData = {};

            for (let i = 1; i <= totalQuestions; i++) {
                const questionKey = String(i);
                const correctAnswer = correctAnswers[questionKey];
                let userAnswer = '';
                let isCorrect = false;
                
                let userAnswerDisplay = 'Not Answered';
                const correctAnswerText = Array.isArray(correctAnswer) ? correctAnswer.join(' / ') : correctAnswer;

                const textInput = document.getElementById(`q${i}`);
                const radioGroup = document.querySelectorAll(`input[name="q${i}"][type="radio"]`);
                
                // Handle Questions 18-23 (Matrix table selections - matching people to statements)
                if (i >= 18 && i <= 23) {
                    // Prefer hidden input value to ensure persistence across re-renders/PDF export
                    const hidden = document.getElementById(`q${i}`);
                    if (hidden && hidden.value) {
                        userAnswer = hidden.value;
                        userAnswerDisplay = userAnswer;
                        isCorrect = userAnswer === correctAnswer;
                        if (isCorrect) score++;
                    } else {
                        const selectedCell = document.querySelector(`.matrix-table td.matrix-selected[data-q="${i}"]`);
                        if (selectedCell) {
                            userAnswer = selectedCell.getAttribute('data-val');
                            userAnswerDisplay = userAnswer;
                            isCorrect = userAnswer === correctAnswer;
                            if (isCorrect) score++;
                        }
                    }
                }
                // Handle Questions 27-32 (Matching table - radio buttons)
                else if (i >= 27 && i <= 32) {
                    const radioInputs = document.querySelectorAll(`input[name="q${i}"][type="radio"]`);
                    let selectedValue = '';
                    
                    radioInputs.forEach(radio => {
                        if (radio.checked) {
                            selectedValue = radio.value;
                        }
                    });
                    
                    userAnswer = selectedValue;
                    userAnswerDisplay = userAnswer || 'Not Answered';
                    isCorrect = userAnswer === correctAnswer;
                    if (isCorrect) score++;
                }
                // (14-17, 33-39 are standard inputs/selects; 40 is radio button; handled below)
                // Handle Text and Select Inputs
                else if (textInput && (textInput.tagName === 'INPUT' || textInput.tagName === 'SELECT')) {
                    userAnswer = textInput.value.trim();
                    userAnswerDisplay = userAnswer || 'Not Answered';
                    isCorrect = Array.isArray(correctAnswer) ?
                        correctAnswer.some(ans => userAnswer.toLowerCase() === ans.toLowerCase()) :
                        userAnswer.toLowerCase() === correctAnswer.toLowerCase();
                    if (isCorrect) score++;
                }
                // Handle Radio Button Inputs (T/F, MCQs)
                else if (radioGroup.length > 0) {
                    const checkedRadio = document.querySelector(`input[name="q${i}"]:checked`);
                    if (checkedRadio) {
                        userAnswer = checkedRadio.value;
                        userAnswerDisplay = userAnswer;
                        isCorrect = userAnswer === correctAnswer;
                        if (isCorrect) score++;
                    }
                }
                 
                // Store results data for download
                resultsData[i] = {
                    isCorrect: isCorrect,
                    userAnswer: userAnswerDisplay,
                    correctAnswer: correctAnswerText
                };
            }

            return { score, totalQuestions, resultsData };
        }

        function showCompletionInterface() {
            // Remove time expiration overlay
            const overlay = document.getElementById('time-expiration-overlay');
            if (overlay) {
                overlay.remove();
            }
            
            // Create completion interface with white background
            const completionOverlay = document.createElement('div');
            completionOverlay.id = 'completion-overlay';
            completionOverlay.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: #ffffff;
                z-index: 10000;
                display: flex;
                justify-content: center;
                align-items: center;
                font-family: Arial, sans-serif;
            `;
            
            const currentSection = getCurrentTestSection();
            let message = '';
            let buttonText = '';
            
            if (currentSection === 'Listening.html') {
                message = 'Listening test is now finished.';
                buttonText = 'Move to Reading Section';
            } else if (currentSection === 'Reading.html') {
                message = 'Reading test is now finished.';
                buttonText = 'Move to Writing Section';
            } else if (currentSection === 'Writing.html') {
                message = 'Writing test is now finished.';
                buttonText = 'Close';
            }
            
            completionOverlay.innerHTML = `
                <div style="text-align: center; padding: 40px; width: 100%; height: 100%; display: flex; flex-direction: column; justify-content: center; align-items: center; color: #333;">
                    <div style="margin-bottom: 30px; color: #667eea;">
                        <svg width="80" height="80" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M9 12l2 2 4-4"></path>
                            <path d="M21 12c0 4.97-4.03 9-9 9s-9-4.03-9-9 4.03-9 9-9 9 4.03 9 9z"></path>
                        </svg>
                    </div>
                    <p style="font-size: 32px; font-weight: 600; margin-bottom: 40px; color: #333; line-height: 1.4;">${message}</p>
                    <button id="next-section-btn" onclick="
                        if('${currentSection}' === 'Listening.html') { 
                            window.location.href='Reading.html'; 
                        }
                        else if('${currentSection}' === 'Reading.html') { 
                            window.location.href='Writing.html'; 
                        }
                        else if('${currentSection}' === 'Writing.html') { 
                            document.getElementById('completion-overlay').remove(); 
                        }
                    " style="
                        background: #667eea;
                        color: white !important;
                        border: none;
                        padding: 16px 32px;
                        font-size: 18px;
                        border-radius: 8px;
                        cursor: pointer;
                        transition: all 0.3s ease;
                        font-weight: 600;
                        min-width: 200px;
                        text-align: center;
                        display: inline-block;
                        line-height: 1.2;
                    ">${buttonText}</button>
                </div>
            `;
            
            document.body.appendChild(completionOverlay);
        }

        function checkAnswers() {
            // This function is now only used for manual submission
            if (testCompleted) return; // Prevent multiple executions
            
            testCompleted = true;
            clearInterval(timerInterval);
            
            // Disable all inputs
            disableAllInputs();
            
            // Get results and download PDF (without showing to user)
            const results = checkAnswersAndGetResults();
            downloadResultsAsPdf(results.score, results.totalQuestions, results.resultsData);
            
            // Show completion interface
            setTimeout(() => {
                showCompletionInterface();
            }, 1000);
        }

        // Duplicate checkAnswersAndGetResults removed; unified checker defined earlier is used below

        function submitAnswers() {
            if (testCompleted) return; // Prevent multiple executions
            
            if (confirm('Are you sure you want to submit your answers? This will download your results as PDF and move to the writing section.')) {
                testCompleted = true;
                clearInterval(timerInterval);
                
                // Disable all inputs
                disableAllInputs();
                
                // Get results and download PDF
                const results = checkAnswersAndGetResults();
                downloadResultsAsPdf(results.score, results.totalQuestions, results.resultsData);
                
                // Navigate to writing section after a short delay
                setTimeout(() => {
                    window.location.href = 'Writing.html';
                }, 2000);
            }
        }

        function calculateBandScore(score) {
            if (score >= 39) return '9.0';
            const mapping = {
                40: 9.0, 39: 9.0, 38: 8.5, 37: 8.5, 36: 8.0, 35: 8.0, 34: 7.5,
                33: 7.5, 32: 7.0, 31: 7.0, 30: 7.0, 29: 6.5, 28: 6.5, 27: 6.5,
                26: 6.0, 25: 6.0, 24: 6.0, 23: 5.5, 22: 5.5, 21: 5.5, 20: 5.5,
                19: 5.0, 18: 5.0, 17: 5.0, 16: 5.0, 15: 5.0, 14: 4.5, 13: 4.5,
                12: 4.0, 11: 4.0, 10: 4.0, 9: 3.5, 8: 3.5, 7: 3.0, 6: 3.0,
                5: 2.5, 4: 2.5
            };
            if (score <= 0) return 0.0;
            if (score === 1) return 1.0;
            if (score <= 3) return 2.0;
            if (score <= 5) return 2.5;
            return mapping[score] || 0.0;
        }

        function getUserAnswer(qNum) {
            const textInput = document.getElementById(`q${qNum}`);
            const radioInput = document.querySelector(`input[name="q${qNum}"]:checked, input[name="q21-22"]:checked`);
            const dropZone = document.querySelector(`.drop-zone[data-q-start="${qNum}"]`);

            if (textInput) { // Handles <input type="text"> and <select>
                return { value: textInput.value, text: textInput.value || 'N/A' };
            }
            // Matrix answers for 18-23
            if (qNum >= 18 && qNum <= 23) {
                const selectedCell = document.querySelector(`.matrix-table td.matrix-selected[data-q="${qNum}"]`);
                const val = selectedCell ? selectedCell.getAttribute('data-val') : null;
                return { value: val, text: val || 'N/A' };
            }
            if (radioInput) {
                return { value: radioInput.value, text: radioInput.value };
            }
            if (dropZone) {
                const droppedItem = dropZone.querySelector('.drag-item');
                return {
                    value: droppedItem ? droppedItem.dataset.value : null,
                    text: droppedItem ? droppedItem.dataset.value : 'N/A'
                };
            }
            return { value: null, text: 'N/A' };
        }


        
        function findQuestionElement(qNum) {
             return document.querySelector(`[data-q-start="${qNum}"]`);
        }


        
        // This function is replaced by disableAllInputs() which is more comprehensive

        function checkValue(userValue, correctValue) {
            if (userValue === null || userValue === undefined) return false;
            const formattedUserValue = userValue.trim().toLowerCase();
            if (Array.isArray(correctValue)) {
                return correctValue.map(v => v.toLowerCase()).includes(formattedUserValue);
            } else {
                return formattedUserValue === String(correctValue).toLowerCase();
            }
        }



        // This function is no longer needed as we use showCompletionInterface() instead

        function switchToPart(partNumber) {
            currentPassage = partNumber;

            // Hide all passages and questions
            document.querySelectorAll('.reading-passage, .question-set, .part-header').forEach(el => {
                el.classList.add('hidden');
            });

            // Show the correct passage, questions, and header
            document.getElementById(`passage-text-${partNumber}`).classList.remove('hidden');
            document.getElementById(`questions-${partNumber}`).classList.remove('hidden');
            document.getElementById(`part-header-${partNumber}`).classList.remove('hidden');

            // Update bottom navigation 'selected' state
            document.querySelectorAll('.footer__questionWrapper___1tZ46').forEach((wrapper, index) => {
                wrapper.classList.toggle('selected', (index + 1) === partNumber);
            });

            // Go to the first question of the part
            const firstQuestionOfPart = {1: 1, 2: 14, 3: 27}[partNumber];
            goToQuestion(firstQuestionOfPart);
        }
        
        function goToQuestion(questionNumber) {
            currentQuestion = questionNumber;

            let passageNumber = 1;
            if (questionNumber >= 14 && questionNumber <= 26) passageNumber = 2;
            else if (questionNumber >= 27) passageNumber = 3;
            
            if (currentPassage !== passageNumber) {
                switchToPart(passageNumber);
                return; 
            }

            if (activeQuestionElement) {
                activeQuestionElement.classList.remove('active-question', 'active-input');
            }

            // Look for specific question elements first (tf-question, multi-choice-question, etc.)
            let targetEl = document.querySelector(`.tf-question[data-q-start="${questionNumber}"], .multi-choice-question[data-q-start="${questionNumber}"], .matching-question-item[data-q-start="${questionNumber}"]`);
            
            // If not found, look for input elements
            if (!targetEl) {
                targetEl = document.getElementById(`q${questionNumber}`);
            }
            
            // If still not found, look for any element with data-q-start
            if (!targetEl) {
                targetEl = document.querySelector(`[data-q-start="${questionNumber}"]`);
            }

            if (targetEl) {
                activeQuestionElement = targetEl;
                 if (targetEl.matches('input[type="text"]') || targetEl.matches('select')) {
                     targetEl.classList.add('active-input');
                 } else {
                     targetEl.classList.add('active-question');
                 }
                 scrollIntoViewIfNeeded(targetEl);
            } else {
                 const pMatch = document.querySelector(`.paragraph-matching-question select[id="q${questionNumber}"]`);
                 if(pMatch) {
                    activeQuestionElement = pMatch;
                    pMatch.classList.add('active-input');
                    scrollIntoViewIfNeeded(pMatch);
                 }
            }

            updateNavigation();
        }
        
        // --- UI & NAVIGATION ---

        function updateNavigation() {
            const navButtons = document.querySelectorAll('.subQuestion');
            navButtons.forEach(btn => btn.classList.remove('active'));
            const activeNav = document.querySelector(`.subQuestion[onclick="goToQuestion(${currentQuestion})"]`);
            if (activeNav) {
                activeNav.classList.add('active');
            }

            const inputs = document.querySelectorAll('.answer-input, .drop-zone.filled, .summary-drop-zone.filled');
            inputs.forEach(input => input.classList.remove('active-input'));
            
            const activeInput = document.getElementById(`q${currentQuestion}`);
            if (activeInput) {
                activeInput.classList.add('active-input');
                if (typeof activeInput.focus === 'function') {
                    activeInput.focus();
                }
            } else {
                const activeQuestionBlock = document.querySelector(`[data-q-start="${currentQuestion}"]`);
                if (activeQuestionBlock) {
                    const firstInput = activeQuestionBlock.querySelector('input, select');
                    if(firstInput) {
                        firstInput.classList.add('active-input');
                         if (typeof firstInput.focus === 'function') {
                            firstInput.focus();
                        }
                    }
                }
            }
        }
        
        function selectDragItem(item) {
            if (selectedDragItem) {
                selectedDragItem.classList.remove('selected');
            }
            selectedDragItem = item;
            if (selectedDragItem) {
                selectedDragItem.classList.add('selected');
            }
        }
        
        window.nextQuestion = () => currentQuestion < 40 && goToQuestion(currentQuestion + 1);
        window.previousQuestion = () => currentQuestion > 1 && goToQuestion(currentQuestion - 1);

        function updateAllIndicators() {
            updateAttemptedCount(1, 1, 13);
            updateAttemptedCount(2, 14, 26);
            updateAttemptedCount(3, 27, 40);
            updateAnsweredNav();
        }
        
        function updateAnsweredNav() {
            const navButtons = document.querySelectorAll('.subQuestion');
            navButtons.forEach(btn => {
                const qNum = parseInt(btn.textContent, 10);
                if (isQuestionAnswered(qNum)) {
                    btn.classList.add('answered');
                } else {
                    btn.classList.remove('answered');
                }
            });
        }
        
        function isQuestionAnswered(qNum) {
            const textInput = document.getElementById(`q${qNum}`);
            if (textInput && textInput.value.trim() !== '') {
                return true;
            }
            const radio = document.querySelector(`input[name="q${qNum}"]:checked`);
            if (radio) {
                return true;
            }
            // Handle Questions 18-23 (Matrix table selections)
            if (qNum >= 18 && qNum <= 23) {
                const sel = document.querySelector(`.matrix-table td.matrix-selected[data-q="${qNum}"]`);

                if (sel) return true;
            }
            // Handle Questions 27-32 (Matching table radio buttons)
            if (qNum >= 27 && qNum <= 32) {
                const radioInputs = document.querySelectorAll(`input[name="q${qNum}"][type="radio"]`);
                for (let radio of radioInputs) {
                    if (radio.checked) {
                        return true;
                    }
                }
            }
            // Handle checkbox groups
            if (qNum >= 21 && qNum <= 22) {
                const checkboxes = document.querySelectorAll(`input[name="q21-22"]:checked`);
                return checkboxes.length > 0;
            }
            if (qNum >= 38 && qNum <= 40) {
                const checkboxes = document.querySelectorAll(`input[name="q38-40"]:checked`);
                return checkboxes.length > 0;
            }
            // Handle drag-and-drop questions
            if (qNum >= 14 && qNum <= 20) {
                const dropZone = document.querySelector(`.drop-zone[data-q-start="${qNum}"]`);
                return dropZone && dropZone.querySelector('.drag-item');
            }
            if (qNum >= 33 && qNum <= 37) {
                const dropZone = document.querySelector(`.summary-drop-zone[data-q-start="${qNum}"]`);
                return dropZone && dropZone.querySelector('.drag-item');
            }
            if (qNum >= 38 && qNum <= 40) {
                const dropZone = document.querySelector(`.summary-drop-zone[data-q-start="${qNum}"]`);
                return dropZone && dropZone.querySelector('.drag-item');
            }
            const checkbox = document.querySelector(`input[name="q${qNum}"]:checked`);
            if (checkbox) {
                return true;
            }
            const dropZone = document.querySelector(`.drop-zone[data-q-start="${qNum}"]`);
            if (dropZone && dropZone.querySelector('.drag-item')) {
                return true;
            }
            return false;
        }

        function scrollIntoViewIfNeeded(element) {
            const panel = element.closest('.questions-panel, .passage-panel');
            const panelRect = panel.getBoundingClientRect();
            const elementRect = element.getBoundingClientRect();
            if (elementRect.top < panelRect.top || elementRect.bottom > panelRect.bottom) {
                element.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }
        }
        
        // --- DRAG AND DROP ---
        
        function initializeDragAndDrop() {
            document.querySelectorAll('.drag-item').forEach(item => {
                item.addEventListener('dragstart', handleDragStart);
                item.addEventListener('dragend', handleDragEnd);
                item.addEventListener('click', () => selectDragItem(item));
            });
            document.querySelectorAll('.drop-zone, .summary-drop-zone, .drag-options-container').forEach(zone => {
                zone.addEventListener('dragover', handleDragOver);
                zone.addEventListener('dragleave', handleDragLeave);
                zone.addEventListener('drop', handleDrop);
            });
        }

        function handleDragStart(e) {
            draggedItem = e.target;
            setTimeout(() => e.target.classList.add('dragging'), 0);
        }

        function handleDragEnd(e) {
            e.target.classList.remove('dragging');
            draggedItem = null;
        }

        function handleDragOver(e) {
            e.preventDefault();
            const targetZone = e.currentTarget;
            if (draggedItem && draggedItem.dataset.dndGroup === targetZone.dataset.dndGroup) {
                targetZone.classList.add('drag-over');
            }
        }

        function handleDragLeave(e) {
            e.currentTarget.classList.remove('drag-over');
        }

        function handleDrop(e) {
            e.preventDefault();
            const targetZone = e.currentTarget;
            targetZone.classList.remove('drag-over');

            if (!draggedItem || draggedItem.dataset.dndGroup !== targetZone.dataset.dndGroup) {
                return;
            }

            const sourceZone = draggedItem.parentElement;
            if (sourceZone === targetZone) return; // Prevent dropping on itself

            const existingItemInTarget = targetZone.classList.contains('drop-zone') || targetZone.classList.contains('summary-drop-zone')
                ? targetZone.querySelector('.drag-item') 
                : null;

            // First, clear the target drop-zone of any text (like question numbers) before adding the new item.
            if (targetZone.classList.contains('drop-zone') || targetZone.classList.contains('summary-drop-zone')) {
                Array.from(targetZone.childNodes).forEach(node => {
                    if (node.nodeType === Node.TEXT_NODE) {
                        node.remove();
                    }
                });
            }

            // Move the item that was in the target (if any) to the source zone.
            if (existingItemInTarget) {
                sourceZone.appendChild(existingItemInTarget);
            }
            
            // Finally, move the dragged item to the target zone.
            targetZone.appendChild(draggedItem);
            targetZone.classList.add('filled');

            // After the move, clean up the source zone if it's a drop-zone and is now empty.
            if ((sourceZone.classList.contains('drop-zone') || sourceZone.classList.contains('summary-drop-zone')) && !sourceZone.querySelector('.drag-item')) {
                 sourceZone.classList.remove('filled');
                 const qNum = sourceZone.dataset.qStart;
                 sourceZone.innerText = qNum; // Restore the question number
            }
            
            updateAllIndicators();
        }

        // Test All / Auto-fill functionality removed
        
        // --- MISC HELPERS ---
        
        function startTimer() {
            if (timerInterval) clearInterval(timerInterval); // Ensure no multiple intervals
            
            // Update timer display immediately
            updateTimerDisplay();
            
            timerInterval = setInterval(() => {
                timeInSeconds--;
                updateTimerDisplay();
                
                if (timeInSeconds <= 0) {
                    clearInterval(timerInterval);
                    timerDisplay.textContent = "Time's up!";
                    timerDisplay.parentElement.classList.remove('warning');
                    // Handle time expiration with automated system
                    handleTimeExpiration();
                }
            }, 1000);
        }
        
        function updateTimerDisplay() {
            const minutes = Math.floor(timeInSeconds / 60);
            const seconds = timeInSeconds % 60;
            const timeString = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            
            timerDisplay.textContent = timeString;
            
            // Add warning color when 5 minutes (300 seconds) or less remain
            if (timeInSeconds <= 300) {
                timerDisplay.parentElement.classList.add('warning');
            } else {
                timerDisplay.parentElement.classList.remove('warning');
            }
        }

        
        function setupCheckboxLimits() {
            const checkboxGroups = [
                { name: 'q21-22', limit: 2 },
                { name: 'q38-40', limit: 3 }
            ];
            checkboxGroups.forEach(group => {
                const checkboxes = document.querySelectorAll(`input[name="${group.name}"]`);
                checkboxes.forEach(checkbox => {
                    checkbox.addEventListener('change', () => {
                        const checkedCount = document.querySelectorAll(`input[name="${group.name}"]:checked`).length;
                        if (checkedCount > group.limit) checkbox.checked = false;
                        updateAllIndicators();
                    });
                });
            });
        }

        function setupExampleHeading() {
            const exampleBox = document.querySelector('.example-box');
            if(exampleBox){
                const title = document.createElement('p');
                title.style.fontWeight = 'bold';
                title.textContent = 'List of Statements';
                // exampleBox.insertBefore(title, exampleBox.firstChild);
            }
        }
        
        function initResize(e) {
            e.preventDefault();
            const startX = e.clientX;
            const startWidth = passagePanel.offsetWidth;
            
            const doDrag = (e) => {
                const newWidth = startWidth + e.clientX - startX;
                if (newWidth > 200 && (document.body.clientWidth - newWidth - resizer.offsetWidth) > 200) {
                    passagePanel.style.flex = `0 0 ${newWidth}px`;
                }
            };
            const stopDrag = () => {
                window.removeEventListener('mousemove', doDrag, false);
                window.removeEventListener('mouseup', stopDrag, false);
            };
            
            window.addEventListener('mousemove', doDrag, false);
            window.addEventListener('mouseup', stopDrag, false);
        }
        
        // --- CONTEXT MENU (Highlighting) ---
        
        function initializeContextMenu() {
            const panels = [passagePanel, questionsPanel];
            let targetElementForClear = null;

            // This listener simply tracks the last valid text selection in either panel.
            document.addEventListener('selectionchange', () => {
                const selection = window.getSelection();
                if (selection && !selection.isCollapsed && selection.toString().trim().length > 0) {
                    const range = selection.getRangeAt(0);
                    if (panels.some(panel => panel.contains(range.commonAncestorContainer))) {
                        selectedRange = range;
                        targetElementForClear = null; // New selection overrides clearing a specific element
                    }
                }
            });

            const showContextMenu = (e) => {
                const target = e.target;
                const isClickOnHighlight = target.closest('.highlight, .comment-highlight');
                const isSelectionActive = selectedRange && selectedRange.toString().trim().length > 0;
                
                let showMenu = false;

                if (isClickOnHighlight) {
                    document.getElementById('menu-highlight').style.display = 'none';
                    document.getElementById('menu-note').style.display = 'none';
                    document.getElementById('menu-clear').style.display = 'block';
                    document.getElementById('menu-clear-all').style.display = 'block';
                    contextMenu.targetElementForClear = isClickOnHighlight;
                    showMenu = true;
                } else if (isSelectionActive && panels.some(panel => panel.contains(selectedRange.commonAncestorContainer))) {
                    document.getElementById('menu-highlight').style.display = 'flex';
                    document.getElementById('menu-note').style.display = 'flex';
                    document.getElementById('menu-clear').style.display = 'none';
                    document.getElementById('menu-clear-all').style.display = 'block'; // Always show clear all
                    showMenu = true;
                }

                if (showMenu) {
                    e.preventDefault();
                    contextMenu.style.display = 'block';
                    const menuHeight = contextMenu.offsetHeight;
                    const menuWidth = contextMenu.offsetWidth;
                    let left = e.pageX;
                    let top = e.pageY;
                    if (left + menuWidth > window.innerWidth) left = window.innerWidth - menuWidth - 5;
                    if (top + menuHeight > window.innerHeight) top = e.pageY - menuHeight - 5;
                    else top = e.pageY - menuHeight - 5;
                    
                    contextMenu.style.left = `${left}px`;
                    contextMenu.style.top = `${top}px`;
                }
            };

            panels.forEach(panel => {
                panel.addEventListener('contextmenu', showContextMenu);
            });

            document.addEventListener('click', (e) => {
                if (contextMenu.style.display === 'block' && !contextMenu.contains(e.target)) {
                    closeContextMenu();
                }
            });
        }

        function closeContextMenu() {
            contextMenu.style.display = 'none';
            selectedRange = null; // Clear range after menu closes
        }

        function unwrapElement(element) {
            const parent = element.parentNode;
            if (!parent) return;
            while (element.firstChild) {
                parent.insertBefore(element.firstChild, element);
            }
            parent.removeChild(element);
            parent.normalize();
        }

        window.highlightText = () => {
            if (selectedRange && !selectedRange.collapsed) {
                const span = document.createElement('span');
                span.className = 'highlight';
                span.appendChild(selectedRange.extractContents());
                selectedRange.insertNode(span);
            }
            closeContextMenu();
            window.getSelection().removeAllRanges();
        };

        window.addNote = () => {
            const note = prompt('Enter your note:');
            if (note && selectedRange && !selectedRange.collapsed) {
                const span = document.createElement('span');
                span.className = 'comment-highlight';
                const tooltip = document.createElement('span');
                tooltip.className = 'comment-tooltip';
                tooltip.textContent = note;
                span.appendChild(selectedRange.extractContents());
                span.appendChild(tooltip);
                selectedRange.insertNode(span);
            }
            closeContextMenu();
            window.getSelection().removeAllRanges();
        };

        window.clearHighlight = () => {
             const elementToClear = contextMenu.targetElementForClear;
             if (elementToClear) {
                 unwrapElement(elementToClear);
             }
             closeContextMenu();
             window.getSelection().removeAllRanges();
        };
        
        window.clearAllHighlights = () => {
            document.querySelectorAll('.highlight, .comment-highlight').forEach(unwrapElement);
            closeContextMenu();
            window.getSelection().removeAllRanges();
        };

        function updateAttemptedCount(part, startQ, endQ) {
            let answeredCount = 0;
            for (let i = startQ; i <= endQ; i++) {
                if (isQuestionAnswered(i)) {
                    answeredCount++;
                }
            }
            const partHeader = document.querySelector(`.footer__questionNo___3WNct[onclick="switchToPart(${part})"]`);
            if (partHeader) {
                const countSpan = partHeader.querySelector('.attemptedCount');
                if (countSpan) {
                     countSpan.textContent = `${answeredCount} of ${endQ - startQ + 1}`;
                }
            }
        }

        // --- TEST FLOW MANAGEMENT ---
        function getCurrentTestSection() {
            const currentFile = window.location.pathname.split('/').pop();
            return currentFile;
        }

        function getNextSection() {
            const currentSection = getCurrentTestSection();
            const sectionFlow = {
                'Listening.html': 'Reading.html',
                'Reading.html': 'Writing.html',
                'Writing.html': null // End of test
            };
            return sectionFlow[currentSection] || null;
        }

        function isLastSection() {
            return getCurrentTestSection() === 'Writing.html';
        }

        function showFinalCompletionMessage() {
            const finalMessage = document.createElement('div');
            finalMessage.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                z-index: 10001;
                display: flex;
                justify-content: center;
                align-items: center;
                font-family: Arial, sans-serif;
                color: white;
            `;
            
            finalMessage.innerHTML = `
                <div style="text-align: center; padding: 40px; background: rgba(255, 255, 255, 0.1); border-radius: 15px; backdrop-filter: blur(10px); max-width: 600px;">
                    <h1 style="font-size: 36px; margin-bottom: 20px;">🎉 Congratulations!</h1>
                    <p style="font-size: 20px; margin-bottom: 15px;">You have completed the IELTS Practice Test</p>
                    <p style="font-size: 16px; margin-bottom: 30px; opacity: 0.9;">
                        All your results have been automatically downloaded as PDF files.<br>
                        Thank you for using our practice test system.
                    </p>
                    <div style="font-size: 14px; opacity: 0.8;">
                        <p>Candidate Name: ${candidateName}</p>
                        <p>Completion Date: ${new Date().toLocaleDateString()}</p>
                        <p>Completion Time: ${new Date().toLocaleTimeString()}</p>
                    </div>
                </div>
            `;
            
            document.body.appendChild(finalMessage);
        }

        // --- GLOBAL FUNCTION EXPOSURE ---
        window.nextQuestion = nextQuestion;
        window.previousQuestion = previousQuestion;
        window.goToQuestion = goToQuestion;
        window.switchToPart = switchToPart;
        window.highlightText = highlightText;
        window.addNote = addNote;
        window.clearHighlight = clearHighlight;
        window.clearAllHighlights = clearAllHighlights;
        window.submitAnswers = submitAnswers;
        


        // --- START THE APP ---
        initialize();
    });
    </script>
</body>
</html>
